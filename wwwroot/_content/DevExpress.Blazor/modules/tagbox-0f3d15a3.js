import{k as e}from"./key-5a3173a6.js";import{T as t}from"./touch-a0ef8cac.js";import{d as o,r as n}from"./disposable-d2c2d283.js";import{getDropDownElement as r,onOutsideClick as s,isDropDownVisible as i}from"./dropdowns-042b4320.js";import{A as a,e as d,d as c,h as u}from"./dom-utils-8b753f73.js";import{scrollToFocusedItem as l,getParametersForVirtualScrollingRequest as m}from"./grid-4478d04c.js";import"./dom-b082d2b1.js";import"./_tslib-1f2a369a.js";import"./focus-utils-43586c36.js";import"./dragAndDropUnit-5165f308.js";import"./evt-dd6ca95c.js";import"./column-resize-7e97b466.js";import"./dx-style-helper-425555fc.js";function f(t){return t.keyCode===e.KeyCode.Down||t.keyCode===e.KeyCode.Up||t.keyCode===e.KeyCode.PageUp||t.keyCode===e.KeyCode.PageDown||t.ctrlKey&&(t.keyCode===e.KeyCode.Home||t.keyCode===e.KeyCode.End)}function v(t){return f(t)||t.keyCode===e.KeyCode.Enter}function y(e){const t=r(e);l(t)}function p(e,t,o){a(e,"value",t),C(e),o&&function(e){e&&e.select()}(e)}function C(e){if(!e.previousSibling)return;const t=e.previousSibling;t.innerText=""===e.value&&e.placeholder?e.placeholder:e.value}function k(e){e=d(e),document.activeElement===e&&K(e)}function g(e,t){const o=e.target;if(!o)return;E(o,!0),function(e){if(e){const t=c(e,"form-control");t.dataset.bluredClass&&(t.className=t.dataset.bluredClass)}}(o);const n=setTimeout((function(){if(delete o.dataset.timerId,document.activeElement!==o)try{h(t,o,!1)}catch(e){}}),200);o.dataset.timerId=String(n)}function E(e,t){if(e.dataset.timerId){const t=parseInt(e.dataset.timerId);clearTimeout(t),delete e.dataset.timerId}t||setTimeout((function(){E(e,!0)}),100)}function K(e){if(e){const t=c(e,"form-control");t.dataset.focusedClass&&(t.className=t.dataset.focusedClass)}}function L(t,o,n,r,s){v(t)&&(t.stopPropagation(),t.preventDefault());(function(t){const o=t.keyCode===e.KeyCode.Esc||t.keyCode===e.KeyCode.Enter;return function(t){return t.altKey&&(t.keyCode===e.KeyCode.Down||t.keyCode===e.KeyCode.Up)}(t)||f(t)||o||function(t){const o=0===t.target.value.length;return t.keyCode===e.KeyCode.Backspace&&o}(t)})(t)&&!t.repeat&&function(e,t,o,n){if(!e.target)return;const r=e.target.value;if(o&&n){const n=o.querySelector(".dxgvCSD");n&&(o=n);const s=m(o);t.invokeMethodAsync("TagBoxWithVirtualScrollingOnKeyDown",r,e.keyCode,e.altKey,e.ctrlKey,s.requestScrollState.itemHeight,s.requestScrollState.scrollTop,s.requestScrollState.scrollHeight)}else t.invokeMethodAsync("TagBoxOnKeyDown",r,e.keyCode,e.altKey,e.ctrlKey)}(t,o,n,s)}function h(e,t,o){if(t){if(t.dataset.lastLostFocusTime){if((new Date).getTime()-parseInt(t.dataset.lastLostFocusTime)<300&&!o)return}t.dataset.lastLostFocusTime=String((new Date).getTime()),e.invokeMethodAsync("OnTagBoxLostFocus",t.value),document.activeElement!==t&&(t.value="")}}function b(a,c,l){const m=d(a);if(!m)return Promise.reject("failed");o(m);const f=d(c.inputElement),y=r(m),p=e=>L(e,l,y,0,c.virtualScrollingEnabled),k=t=>function(t,o){v(t)&&(t.stopPropagation(),t.preventDefault(),t.keyCode!==e.KeyCode.Up&&t.keyCode!==e.KeyCode.Down||o.invokeMethodAsync("OnTagBoxArrowKeyUp",t.keyCode===e.KeyCode.Up))}(t,l),b=e=>function(e){K(e.target)}(e),T=e=>function(e,t,o){o&&t.invokeMethodAsync("OnTagBoxProcessFiltering",e.target.value)}(e,l,c.filteringEnabled),w=e=>function(e,t,o){t.isDisabled||o.invokeMethodAsync("SetDropDownVisible"),t.enabled&&e.focus()}(f,c,l),D=e=>g(e,l),S=e=>C(e.target),j=e=>E(f,!1),I=e=>s(e,m,(()=>{u(m)||o(m);const e=document.activeElement===f,t=f.dataset.timerId>0,n=y&&i(y);E(f,!1),(e||t||n)&&h(l,f,!0)}));return f.addEventListener("keydown",p),f.addEventListener("keyup",k),f.addEventListener("focus",b),f.addEventListener("blur",D),f.addEventListener("input",S),f.addEventListener("input",T),m.addEventListener("click",w),m.addEventListener("mousedown",j),document.addEventListener(t.touchMouseDownEventName,I),n(m,(()=>{f.removeEventListener("keydown",p),f.removeEventListener("keyup",k),f.removeEventListener("focus",b),f.removeEventListener("blur",D),f.removeEventListener("input",S),f.removeEventListener("input",T),m.removeEventListener("click",w),m.removeEventListener("mousedown",j),document.removeEventListener(t.touchMouseDownEventName,I)})),C(f),Promise.resolve("ok")}function T(e){return(e=d(e))&&o(e),Promise.resolve("ok")}const w={init:b,dispose:T,prepareInputIfFocused:k,scrollToFocusedItem:y,fitInputWidth:C,forceInputValue:p};export{w as default,T as dispose,C as fitInputWidth,p as forceInputValue,b as init,k as prepareInputIfFocused,y as scrollToFocusedItem};

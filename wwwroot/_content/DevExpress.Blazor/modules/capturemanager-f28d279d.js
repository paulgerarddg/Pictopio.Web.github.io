import{E as t}from"./eventhelper-dec6cde0.js";class e{constructor(){this.handlers=[],this.raise=t=>{this.handlers.slice(0).forEach((e=>e(t)))}}subscribe(t){this.handlers.push(t)}unsubscribe(t){this.handlers=this.handlers.filter((e=>e!==t))}}class r{constructor(){this.handlers=[]}subscribe(t){this.handlers.push(t)}unsubscribe(t){this.handlers=this.handlers.filter((e=>e!==t))}raise(t,e){this.handlers.slice(0).forEach((r=>r(t,e)))}}class n{constructor(){this.lockCount=0}get IsLocked(){return this.lockCount>0}lock(){this.lockCount+=1}unlock(){this.IsLocked&&(this.lockCount-=1)}reset(){this.lockCount=0}lockOnce(){this.IsLocked||this.lock()}doLockedAction(t){this.lock();try{t()}finally{this.unlock()}}doIfNotLocked(t){this.IsLocked||t()}doLockedActionIfNotLocked(t){this.doIfNotLocked((()=>this.doLockedAction(t)))}}class s{constructor(){this.handled=!1}}class a extends s{constructor(){super(...arguments),this.nextInteractionHandled=!1}}class i{constructor(){this._lostCaptureEvent=new e,this._gotCaptureEvent=new e,this._capturedElement=null,this._captureStack=[],this.pointerDownHandler=this.handlePointerDown.bind(this),this.mouseClickHandler=this.handleClick.bind(this),this.pointerUpHandler=this.handlePointerUp.bind(this),this.keyDownHandler=this.handleKeyDown.bind(this),this.capturedInteractionLocker=new n,this.preventNextPointerInteraction=!1,document.addEventListener("pointerdown",this.pointerDownHandler,{capture:!0}),document.addEventListener("click",this.mouseClickHandler,{capture:!0}),document.addEventListener("pointerup",this.pointerUpHandler,{capture:!0}),document.addEventListener("keydown",this.keyDownHandler,{capture:!0})}get hasCapture(){return!!this._capturedElement}get lostCapture(){return this._lostCaptureEvent}get gotCapture(){return this._gotCaptureEvent}get capturedElement(){return this._capturedElement}get captureStackCount(){return this._captureStack.length}capture(t,e=!0){if(t===this.capturedElement)return!0;if(this.capturedElement&&!this.removeCapture(this.capturedElement,t))return!1;return this.createCapture(this._capturedElement,t,e)}releaseCapture(t){var e;if(this.capturedElement!==t)return this._captureStack=this._captureStack.filter((e=>e!==t)),!0;const r=null!==(e=this._captureStack.pop())&&void 0!==e?e:null;return this.capture(r,!1)}removeCapture(t,e){const r={sender:t,target:e,result:!0};this.lostCapture.raise(r);return!!r.result&&(t.lostCapture(),!0)}createCapture(t,e,r){if(!e)return this._capturedElement=null,!0;const n={sender:e,result:!0};this.gotCapture.raise(n);return!!n.result&&(t&&r&&this._captureStack.push(t),this._capturedElement=e,e.gotCapture(),!0)}handlePointerUp(e){(this.capturedInteractionLocker.IsLocked||this.preventNextPointerInteraction)&&t.markHandled(e,!1)}handleClick(e){this.capturedInteractionLocker.IsLocked?t.markHandled(e,!1):this.preventNextPointerInteraction&&(this.preventNextPointerInteraction=!1,t.markHandled(e,!1))}async handlePointerDown(e){if(!this.capturedInteractionLocker.IsLocked&&(this.preventNextPointerInteraction=!1,this.capturedElement))try{this.capturedInteractionLocker.lock();const r=new a;await this.capturedElement.processCapturedPointerDownAsync(e,r),this.preventNextPointerInteraction=r.handled&&r.nextInteractionHandled,this.preventNextPointerInteraction&&t.markHandled(e,!1)}finally{this.capturedInteractionLocker.unlock()}}async handleKeyDown(t){var e;if(this.hasCapture&&!this.capturedInteractionLocker.IsLocked)try{this.capturedInteractionLocker.lock();const r=new s;await(null===(e=this.capturedElement)||void 0===e?void 0:e.processCapturedKeyDownAsync(t,r))}finally{this.capturedInteractionLocker.unlock()}}hasCapturedElementForTests(){return this.hasCapture}getCapturedElementForTests(){return this.capturedElement}}function o(){return c}const c=new i,u=Object.freeze({__proto__:null,CaptureInteractionOptions:s,PointerCaptureInteractionOptions:a,CaptureManager:i,getCaptureManagerSingletonForTests:o,captureManagerSingleton:c,default:{CaptureManager:i,captureManagerSingleton:c,getCaptureManagerSingletonForTests:o}});export{n as L,e as S,r as a,u as b,c};

import{B as e,D as t}from"./dom-b082d2b1.js";import{k as n}from"./key-5a3173a6.js";import{DxInputEditorBase as s,EditorsProccessedEvents as i}from"./input-09fb1a10.js";import"./_tslib-1f2a369a.js";import"./dx-html-element-base-de595fb7.js";import"./data-qa-utils-8be7c726.js";import"./dx-ui-handlers-bridge-4076ae57.js";class o{}var a;o.AdaptiveMainElementCssClass="dxbs-mobile-spin",o.ButtonClass="dropdown-toggle",o.AdaptiveButtonClass="dxbs-mobile-btn",o.ToggleClass="dxbs-spin-edit-toggle",o.InputGroupCssClass="dxbs-spin-btn-group",o.AdaptiveInputGroupCssClass="dxbs-mobile-spin-btns",o.SpinButtonsSelector=".dxbs-edit-btn.inc, .dxbs-edit-btn.dec",o.ToggleSelector="span.dxbs-dropdown-toggle",o.InputGroupAppendSelector=".dxbs-input-group-append",o.InputGroupInitialClass="dx-blazor-spin-btn-initial",function(e){e[e.None=0]="None",e[e.ArrowUp=1]="ArrowUp",e[e.ArrowDown=2]="ArrowDown",e[e.SpinButton=3]="SpinButton"}(a||(a={}));customElements.define("dxbl-spinedit",class extends s{constructor(){super(...arguments),this.LongTapTrigger=a.None,this.needExponentialView=!1,this.useAdaptiveLayout=!1,this.regex=/^-?(\d)*$/,this.wheelTimerId=-1,this.pointerDownTimerId=-1,this.boundOnInputHandler=this.onInput.bind(this),this.boundOnPasteHandler=this.onPaste.bind(this),this.boundOnMouseWheelHandler=this.onMouseWheel.bind(this),this.boundOnKeyDownHandler=this.onKeyDown.bind(this),this.boundOnKeyUpHandler=this.onKeyUp.bind(this),this.boundButtonOnPointerDownHandler=this.onButtonPointerDown.bind(this),this.boundButtonOnPointerUpHandler=this.onButtonPointerUp.bind(this)}getButtons(){return this.querySelectorAll(o.SpinButtonsSelector)}initializeComponent(){super.initializeComponent(),this.useAdaptiveLayout=this.useAdaptiveLayout||e.MobileUI,this.initializeButtonsView(),this.addEventSubscription()}disposeComponent(){delete this.uiHandlersBridge;const e=this.getInputElement();e.removeEventListener("input",this.boundOnInputHandler),e.removeEventListener("paste",this.boundOnPasteHandler),e.removeEventListener("keydown",this.boundOnKeyDownHandler),e.removeEventListener("keyup",this.boundOnKeyUpHandler),this.removeEventListener("wheel",this.boundOnMouseWheelHandler),super.disposeComponent()}addEventSubscription(){const e=this.getInputElement();this.bitsHasEvent(this.proccessedEvents,i.Input)&&e.addEventListener("input",this.boundOnInputHandler),this.bitsHasEvent(this.proccessedEvents,i.Paste)&&e.addEventListener("paste",this.boundOnPasteHandler),e.addEventListener("keydown",this.boundOnKeyDownHandler),e.addEventListener("keyup",this.boundOnKeyUpHandler),this.bitsHasEvent(this.proccessedEvents,i.Wheel)&&this.addEventListener("wheel",this.boundOnMouseWheelHandler,{passive:!1});this.getButtons().forEach((e=>{e.addEventListener("pointerdown",this.boundButtonOnPointerDownHandler)}))}initializeButtonsView(){const e=this.useAdaptiveLayout?o.AdaptiveButtonClass:o.ButtonClass,n=this.useAdaptiveLayout?o.AdaptiveInputGroupCssClass:o.InputGroupCssClass,s=this.getButtons();s&&s.forEach((n=>{if(t.addClassName(n,e),!this.useAdaptiveLayout){const e=n.querySelector(o.ToggleSelector);e&&t.addClassName(e,o.ToggleClass)}}));const i=this.querySelector(o.InputGroupAppendSelector);i&&(t.addClassName(i,n),t.removeClassName(i,o.InputGroupInitialClass)),this.useAdaptiveLayout&&t.addClassName(this,o.AdaptiveMainElementCssClass)}registerButton(e){(t.hasClassName(e,"inc")||t.hasClassName(e,"dec"))&&e.addEventListener("pointerdown",this.boundButtonOnPointerDownHandler)}unregisterButton(e){(t.hasClassName(e,"inc")||t.hasClassName(e,"dec"))&&(e.removeEventListener("pointerup",this.boundButtonOnPointerUpHandler),e.removeEventListener("pointerout",this.boundButtonOnPointerUpHandler),e.removeEventListener("pointerdown",this.boundButtonOnPointerDownHandler))}onInput(e){const t=this.getInputElement();let n=t.dataset.selectionStartBeforePaste?t.value.trim():t.value;this.decimalSeparator&&(n=n.replace(/[.|,]/g,this.decimalSeparator));let s=t.selectionStart,i=t.selectionEnd;this.regex.test(n)?(n!==t.value&&(t.value=n),t.dataset.previousValue=n):(t.dataset.selectionStartBeforePaste&&t.dataset.selectionEndBeforePaste?(s=parseInt(t.dataset.selectionStartBeforePaste),i=parseInt(t.dataset.selectionEndBeforePaste)):s&&i&&t.dataset.previousValue&&(s--,i+=t.dataset.previousValue.length-n.length),t.value=t.dataset.previousValue||""),t.dataset.selectionStartBeforePaste&&(t.removeAttribute("data-selection-start-before-paste"),t.removeAttribute("data-selection-end-before-paste")),t.selectionStart=s,t.selectionEnd=i}onPaste(e){const t=this.getInputElement();t.dataset.selectionStartBeforePaste=String(t.selectionStart),t.dataset.selectionEndBeforePaste=String(t.selectionEnd)}onKeyDown(e){if(this.isNavigationKey(e)&&(this.LongTapTrigger===a.None||this.isButtonEqualLongTapTrigger(e.keyCode))){e.preventDefault();const t=e.keyCode===n.KeyCode.Up;this.LongTapTrigger===a.None&&(this.LongTapTrigger=t?a.ArrowUp:a.ArrowDown),this.sendChangeValue(t)}}onKeyUp(e){var t;this.isNavigationKey(e)&&this.isButtonEqualLongTapTrigger(e.keyCode)&&(this.LongTapTrigger=a.None,null===(t=this.uiHandlersBridge)||void 0===t||t.send("applyValue",null))}onInputFocusOut(e){var t;this.LongTapTrigger!==a.ArrowUp&&this.LongTapTrigger!==a.ArrowDown||(this.LongTapTrigger=a.None,null===(t=this.uiHandlersBridge)||void 0===t||t.send("applyValue",null)),this.bitsHasEvent(this.proccessedEvents,i.ServerFocusOut)&&super.onInputFocusOut(e)}isButtonEqualLongTapTrigger(e){return e===n.KeyCode.Up&&this.LongTapTrigger===a.ArrowUp||e===n.KeyCode.Down&&this.LongTapTrigger===a.ArrowDown}onMouseWheel(e){const t=this.getInputElement();if(!this.checkValidInput(t)||document.activeElement!==t)return;-1!==this.wheelTimerId&&clearTimeout(this.wheelTimerId),e.preventDefault(),this.sendChangeValue(e.deltaY<0);this.wheelTimerId=window.setTimeout((()=>{var e;null===(e=this.uiHandlersBridge)||void 0===e||e.send("applyValue",null)}).bind(this),500)}onButtonPointerDown(e){const n=this.getButton(e);if(!n||this.LongTapTrigger!==a.None)return;e.preventDefault(),this.LongTapTrigger=a.SpinButton;const s=this.getInputElement();this.useAdaptiveLayout||t.setFocus(s);const i=t.hasClassName(n,"inc");this.sendChangeValue(i),this.pointerDownTimerId=window.setTimeout(this.startPointerLongTap.bind(this),1e3,i),n.addEventListener("pointerup",this.boundButtonOnPointerUpHandler),n.addEventListener("pointerout",this.boundButtonOnPointerUpHandler)}getButton(e){const n=e.composedPath();for(const e in n){const s=n[e];if(s&&t.hasClassName(s,"dxbs-edit-btn"))return s}return null}startPointerLongTap(e){this.pointerDownTimerId=window.setInterval(this.sendChangeValue.bind(this),50,e)}onButtonPointerUp(e){var n;let s=e.target;t.hasClassName(s,"dxbs-edit-btn")||(s=t.getParentByTagName(s,"button")),clearTimeout(this.pointerDownTimerId),this.LongTapTrigger=a.None,s.removeEventListener("pointerup",this.boundButtonOnPointerUpHandler),s.removeEventListener("pointerout",this.boundButtonOnPointerUpHandler),null===(n=this.uiHandlersBridge)||void 0===n||n.send("applyValue",null)}sendChangeValue(e){var t;const n={increment:e,value:this.getCurrentInputValue()};null===(t=this.uiHandlersBridge)||void 0===t||t.send("changeValue",n)}getCurrentInputValue(){const e=this.getInputElement(),t=e.getAttribute("dx-mask-value");return null==t?e.value:t}checkValidInput(e){return!e.disabled&&!e.readOnly}isNavigationKey(e){return e.keyCode===n.KeyCode.Up||e.keyCode===n.KeyCode.Down}subscribeNewEvents(e){super.subscribeNewEvents(e);const t=this.getInputElement();e&&t&&(this.bitsHasEvent(e,i.Input)&&t.addEventListener("input",this.boundOnInputHandler),this.bitsHasEvent(e,i.Paste)&&t.addEventListener("paste",this.boundOnPasteHandler),this.bitsHasEvent(e,i.Wheel)&&this.addEventListener("wheel",this.boundOnMouseWheelHandler,{passive:!1}))}unsubscribeOldEvents(e){super.unsubscribeOldEvents(e);const t=this.getInputElement();e&&t&&(this.bitsHasEvent(e,i.Input)&&t.removeEventListener("input",this.boundOnInputHandler),this.bitsHasEvent(e,i.Paste)&&t.removeEventListener("paste",this.boundOnPasteHandler),this.bitsHasEvent(e,i.Wheel)&&this.removeEventListener("wheel",this.boundOnMouseWheelHandler))}static get observedAttributes(){return this.baseObservedAttributes.concat(["decimal-separator","need-exponential-view","use-adaptive-layout"])}attributeChangedCallbackInternal(e,t,n){switch(e){case"decimal-separator":this.decimalSeparator=n,this.applyRegex();break;case"need-exponential-view":this.needExponentialView=null!==n,this.applyRegex();break;case"use-adaptive-layout":this.useAdaptiveLayout=null!==n}}applyRegex(){this.decimalSeparator&&(this.regex=this.needExponentialView?/^-?(\d+|[,.]\d+|\d+[,.]\d+|\d+[,.]|[,.])?([eE]?[+-]?(\d)*)?$/:/^-?(\d+|[,.]\d+|\d+[,.]\d+|\d+[,.]|[,.])?$/)}});const r={loadModule:function(){}};export{r as default};

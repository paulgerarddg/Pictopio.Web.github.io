import{z as e}from"./dom-utils-8b753f73.js";import{E as n,F as t,D as o,a as r,R as s}from"./dragAndDropUnit-5165f308.js";import"./dom-b082d2b1.js";import"./_tslib-1f2a369a.js";import"./touch-a0ef8cac.js";let i,c,f,u,l,d,a,p,_,m,v=null,h=-1,x=-1,g=!0,w=!1;function y(e,t,o,r){const s=Array.from(t).map((e=>function(e){const n=e.clientRef;return n._dx_server_ref=e.serverRef,n}(e)));if(u?u._id!==r._id&&(B(u),u=r):u=r,!p){p=e;let n=p;for(;n.parentNode!==document&&n.classList;){if(n.classList.contains("modal-dialog")){w=!0;break}n=n.parentNode}}if(l=new Map,d&&d.dispose(),d=new n(p),v||(c=new Map,f=new Map,v=s),x=-1,d.attachEventWithContext(document,"keydown",L,document),v&&(_=function(e,n){if(w)return e;let t=e,o=window.getComputedStyle(t);for(;o.position!==n&&t.parentNode!==document;)t=t.parentNode,o=window.getComputedStyle(t);return t}(p,"absolute"),E(o&&!w),b())){const e=d.attachEvent(_,"focusin",(function(){e.dispose(),v[0].focus()}))}M(),m&&(m.parentNode.removeChild(m),m=null)}function E(e){g=e,a&&a.dispose();const n=document.querySelector(".column-chooser-exit-button");a=n?new t(n,null,p,!g):null,f.forEach((function(e){e.dispose()})),f=new Map,v.forEach((function(e){!function(e,n){let r=c.get(e._dx_server_ref);r||(r=new o(e,e.parentNode,j,".column-chooser-drag-icon-owner",F,w),r.onDragStart=z,r.onDrag=q,r.onDragCancel=R,r.onDropAnimationEnd=A,c.set(e._dx_server_ref,r));r.reset(),e.classList.remove("up"),e.classList.remove("down"),e.classList.remove("freeze");let s=f.get(e._dx_server_ref);s||(s=new t(e,".custom-control-input",n,w||!g),s.onFocus=C,s.onBlur=D,s.onClick=k,f.set(e._dx_server_ref,s));s.reset()}(e,_)}))}function b(){return g}function L(e){switch(b()||(E(!0),9===e.keyCode&&v[v.length-1].focus()),e.keyCode){case 32:x>=0&&(e.preventDefault(),v[x].click());break;case 38:e.preventDefault(),N(-1);break;case 40:e.preventDefault(),N(1)}}function N(e){if(!v||!c)return;x+=e,x=x<0?v.length-1:x,x%=v.length;const n=f.get(v[x]._dx_server_ref);n&&n.focus()}function C(e){x=v.indexOf(e)}function D(e){x===v.indexOf(e)&&(x===v.length-1&&a&&a.focus(),x=-1)}function k(e){b()&&E(!1)}function O(e){return v.find((function(n,t,o){return function(e,n){const t=S(e);return!!t&&(t.top<=n&&n<=t.bottom)}(n,e.y)}))}function j(e){const n=O(e);return n?{item:n,relativeRect:S(n)}:null}function M(){if(i&&i.style){const e=c.get(i._dx_server_ref);e&&e.reset();const n=f.get(i._dx_server_ref);n&&n.reset(),h=-1,i.childNodes.forEach((function(e){e.style&&(e.style.visibility="")})),i=null}}function z(e){i=e,h=v.indexOf(i),v.forEach((function(e){e.blur(),e!==i&&e.classList.add("freeze")})),i.childNodes.forEach((function(e){e.style&&(e.style.visibility="hidden")}));const n=f.get(i._dx_server_ref);n&&n.stop()}function S(e){let n=l.get(e);if(n)return n;const t=r(e),o=F();return n=new s(t.x-o.x,t.y-o.y,t.width,t.height),l.set(e,n),n}function A(n,t){v.forEach((function(e){c.get(e._dx_server_ref).stop()})),m=p.cloneNode(!0),e(m),m.style["z-index"]=2e3,p.parentNode.appendChild(m),u.invokeMethodAsync("OnElementsExchange",n._dx_server_ref,t._dx_server_ref).catch((function(e){console.error(e)}))}function R(e){v.forEach((function(e){e.classList.remove("up"),e.classList.remove("down"),e.classList.remove("freeze")})),M()}function F(){const e=w?p.parentNode:p,n=r(e);return 0!==e.scrollTop?{x:n.x,y:n.y-e.scrollTop}:n.location}function T(e){f.get(e._dx_server_ref).updateStyleMetadata()}function q(e,n){if(!e)return;-1===h&&(h=v.indexOf(e));const t=O(n.centerOfDraggingObject);if(!t)return;const o=v.indexOf(t);let r=!1;v.forEach(h<o?function(e){i===e&&(r=!0),r?(T(e),e.classList.add("up")):e.classList.remove("up","down"),t===e&&(r=!1)}:h>o?function(e){t===e&&(r=!0),r?(T(e),e.classList.add("down")):e.classList.remove("up","down"),i===e&&(r=!1)}:function(e){e.classList.remove("up","down")})}function B(e){e._id===u._id&&(e.dispose(),c.forEach((function(e){e.dispose()})),f.forEach((function(e){e.dispose()})),v&&v.forEach((function(e){e._dx_server_ref.dispose()})),v=null,i=null,h=-1,p=null,l=null,c=null,f=null,u=null,d&&d.dispose(),d=null,m&&(m.parentNode.removeChild(m),m=null))}const U={init:y,dispose:B};export{U as default,B as dispose,y as init};

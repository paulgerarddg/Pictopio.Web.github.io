import{T as e}from"./touch-a0ef8cac.js";import{DxUIHandlersBridgeTagName as t}from"./dx-ui-handlers-bridge-4076ae57.js";import{D as n,P as i,a as o,b as r,c as s,H as l}from"./dx-html-element-base-de595fb7.js";import{D as a,B as d}from"./dom-b082d2b1.js";import{T as h}from"./transformhelper-3935ca6a.js";import{C as c}from"./component-isolate-styles-builder-97de49eb.js";import"./data-qa-utils-8be7c726.js";import"./_tslib-1f2a369a.js";class u{constructor(e,t,n,i){this._initWidth=e,this._minWidth=t,this._IsIndent=n,this._IsEmpty=i,this._firstRenderWidth=0,this._currentWidth=0,this._changedWidth=0}get initWidth(){return this._initWidth}get minWidth(){return this._minWidth}get isFixed(){return!!this._initWidth}get IsIndent(){return this._IsIndent}get IsEmpty(){return this._IsEmpty}get IsFree(){return!(this.changedWidth||this.initWidth||this.IsIndent||this.IsEmpty)}get IsPercent(){return!this.changedWidth&&!!this.initWidth&&-1!==this.initWidth.indexOf("%")}get firstRenderWidth(){return this._firstRenderWidth}set firstRenderWidth(e){this._firstRenderWidth=e}get currentWidth(){return this._currentWidth}set currentWidth(e){this._currentWidth=e}get changedWidth(){return this._changedWidth}set changedWidth(e){this._changedWidth=e}correctWidthByMinValue(){return this.currentWidth<this.minWidth&&(this.changedWidth=this.minWidth,!0)}distributeExcess(e){let t=this.currentWidth-e;return t<this.minWidth&&(t=this.minWidth),this.changedWidth=t,this.currentWidth-t}getPercents(){return this.IsPercent?parseFloat(this.initWidth.replace("%","")):0}}class g{static findHeaderElement(e){const t=e;return t?g.isHeaderElement(t)?t:t.closest(`.${f.HeaderElementClassName}`):null}static isHeaderElement(e){return e&&a.hasClassName(e,f.HeaderElementClassName)}static getColumnUniqueId(e){const t=e.dataset.columnUid;return t?Number(t):-1}static getContentElement(e){return e.querySelector(`.${f.HeaderContentClassName}`)}static allowDrag(e){return a.hasClassName(e,f.AllowDragClassName)}static allowGroup(e){const t=e.dataset.allowGroup;return!t||JSON.parse(t)}static allowSort(e){const t=e.dataset.allowSort;return!t||JSON.parse(t)}}class m{static getSvgHtml(e){return`\n<svg class="dx-image" role="img">\n    <use href="_content/DevExpress.Blazor/dx-blazor.svg#${e}"></use>\n</svg>`}}m.ArrowUpIconName="dx-arrow-up";var C,p;!function(e){e[e.Left=0]="Left",e[e.Right=1]="Right"}(C||(C={}));class b{constructor(){this.downTargetElement=b.addTargetToDom(f.DraggingDownTargetClassName),this.upTargetElement=b.addTargetToDom(f.DraggingUpTargetClassName);const e=this.upTargetElement.getBoundingClientRect();this.targetElementSize={width:e.width,height:e.height},this.upTargetElementPosition=null,this.downTargetElementPosition=null,this.hide()}show(){this.upTargetElementPosition&&this.downTargetElementPosition&&(this.downTargetElement.style.transform=h.translateByPoint(this.downTargetElementPosition),this.upTargetElement.style.transform=h.translateByPoint(this.upTargetElementPosition),a.removeClassName(this.downTargetElement,"d-none"),a.removeClassName(this.upTargetElement,"d-none"))}hide(){a.addClassName(this.downTargetElement,"d-none"),a.addClassName(this.upTargetElement,"d-none")}setPositionRelativeToElement(e,t){this.setUpTargetPosition(e,t),this.setDownTargetPosition(e,t)}setUpTargetPosition(e,t){this.upTargetElementPosition={x:this.getTargetXCoordinate(e,t),y:e.y+e.height}}setDownTargetPosition(e,t){this.downTargetElementPosition={x:this.getTargetXCoordinate(e,t),y:e.y-this.targetElementSize.height}}getTargetXCoordinate(e,t){let n=e.x-this.targetElementSize.width/2;return t===C.Right&&(n+=e.width),n}dispose(){b.removeElementsByClassName(f.DraggingDownTargetClassName),b.removeElementsByClassName(f.DraggingUpTargetClassName)}static removeElementsByClassName(e){const t=document.querySelectorAll(`.${e}`);for(let e=0;e<t.length;e++)t[e].remove()}static addTargetToDom(e){const t=document.createElement("div");return t.className=e,t.innerHTML=m.getSvgHtml(m.ArrowUpIconName),document.body.appendChild(t),t}}!function(e){e[e.Header=0]="Header",e[e.GroupPanel=1]="GroupPanel"}(p||(p={}));class v{constructor(e){this.boundOnDocumentMouseMoveHandler=this.onDocumentMouseMove.bind(this),this.boundOnDocumentScrollHandler=this.onDocumentScroll.bind(this),this.boundOnHeaderMouseMoveHandler=this.onHeaderMouseMove.bind(this),this.boundOnElementToDropMouseOutHandler=this.onElementToDropMouseOut.bind(this),this.boundOnGroupPanelMouseMoveHandler=this.onGroupPanelMouseMove.bind(this),this.boundOnEmptyHeaderCellMouseMoveHandler=this.onEmptyHeaderCellMouseMove.bind(this),this.boundOnGroupFreeSpaceMouseMoveHandler=this.onGroupFreeSpaceMouseMove.bind(this),this.draggableContext=null,this.isRefreshUIRequested=!1,this.grid=e}start(e,t){const n=v.addDraggableHeaderToDOM(e);this.draggableContext=v.createDraggableContext(e,n,t),this.updateDraggableElementPosition(),this.addEventSubscriptions()}isStarted(){return!!this.draggableContext}onDocumentMouseMove(e){this.draggableContext&&(this.draggableContext.currentCursorPosition={x:e.pageX,y:e.pageY},this.draggableContext.initialScrollPosition=this.draggableContext.currentScrollPosition,this.updateDraggableElementPosition(),this.refreshUI())}onDocumentScroll(e){this.draggableContext&&(this.draggableContext.currentScrollPosition=v.getDocumentScrollPosition(),this.draggableContext.srcHeaderPosition=v.getElementPosition(this.draggableContext.srcHeaderElement),this.draggableContext.mouseOverElement&&this.setMouseOverElementInfo(this.draggableContext.mouseOverElement),this.updateDraggableElementPosition(),this.refreshUI())}onHeaderMouseMove(e){const t=g.findHeaderElement(e.target);t&&(this.updateDraggableContext(t,e),this.refreshUI())}onGroupPanelMouseMove(){const e=this.grid.getGroupPanelContentContainer();this.onPanelElementMouseMove(e,p.GroupPanel)}onEmptyHeaderCellMouseMove(){const e=this.grid.getEmptyHeaderCellContentContainer();this.onPanelElementMouseMove(e,p.Header)}onGroupFreeSpaceMouseMove(){const e=this.grid.getGroupContentFreeSpaceElement();this.onPanelElementMouseMove(e,p.GroupPanel)}onPanelElementMouseMove(e,t){e&&this.draggableContext&&this.draggableContext.mouseOverElement!==e&&(this.clearMoveStateFromDraggableContext(),this.setMouseOverElementInfo(e),this.draggableContext.dropArea=t,this.isPossibleDropToCurrentArea()&&(this.draggableContext.isPossibleDropColumn=!0,this.draggableContext.targets.setPositionRelativeToElement(this.draggableContext.mouseOverElementRect,C.Left)),this.refreshUI())}isPossibleDropToCurrentArea(){var e,t;return(null===(e=this.draggableContext)||void 0===e?void 0:e.dropArea)!==p.GroupPanel||(null===(t=this.draggableContext)||void 0===t?void 0:t.allowGroup)}onElementToDropMouseOut(e){this.clearMoveStateFromDraggableContext(),this.refreshUI()}createColumnMovedHandlerArgs(){if(!this.draggableContext||!this.draggableContext.isPossibleDropColumn)return null;const e=this.draggableContext;return{columnUid:e.columnUid,beforeColumnUid:e.beforeColumnUid,dropArea:e.dropArea}}stop(){var e;this.isRefreshUIRequested=!1,null===(e=this.draggableContext)||void 0===e||e.targets.dispose(),this.draggableContext=null,v.removeDraggableHeaderFromDom(),this.removeEventSubscriptions(),a.removeClassName(document.body,f.MoveCursorCssClassName)}updateDraggableContext(e,t){if(this.clearMoveStateFromDraggableContext(),null==this.draggableContext||this.draggableContext.srcHeaderElement===e)return;if(this.setMouseOverElementInfo(e),!this.isPossibleDropToCurrentArea())return;const n=this.isThereCursorInLeftPart(t);if(n&&e.previousElementSibling!==this.draggableContext.srcHeaderElement&&(this.draggableContext.beforeColumnUid=g.getColumnUniqueId(e),this.draggableContext.isPossibleDropColumn=!0),!n&&e.nextElementSibling!==this.draggableContext.srcHeaderElement){const t=e.nextElementSibling;t&&(this.draggableContext.beforeColumnUid=g.getColumnUniqueId(t)),this.draggableContext.isPossibleDropColumn=!0}this.draggableContext.isPossibleDropColumn&&this.draggableContext.targets.setPositionRelativeToElement(this.draggableContext.mouseOverElementRect,n?C.Left:C.Right)}getDropColumnArea(e){const t=this.grid.getGroupPanelContentContainer();return t&&v.isThereHeaderInsideGroupPanel(t,e)?p.GroupPanel:p.Header}static isThereHeaderInsideGroupPanel(e,t){const n=e.childNodes.length;for(let i=0;i<n;i++)if(e.childNodes[i]===t)return!0;return!1}refreshUI(){this.isRefreshUIRequested||(this.isRefreshUIRequested=!0,requestAnimationFrame((()=>{this.isRefreshUIRequested=!1;const e=this.draggableContext;e&&(e.headerElement.style.transform=`translate(${Math.round(e.draggableElementPosition.x)}px, ${Math.round(e.draggableElementPosition.y)}px)`,a.addClassName(e.headerElement,"visible"),e.mouseOverElement?e.targets.show():e.targets.hide(),a.addClassName(document.body,f.MoveCursorCssClassName))})))}setMouseOverElementInfo(e){if(!this.draggableContext)return;this.draggableContext.mouseOverElement=e;const t=e.getBoundingClientRect();this.draggableContext.mouseOverElementRect={x:t.left+this.draggableContext.currentScrollPosition.x,y:t.top+this.draggableContext.currentScrollPosition.y,width:t.width,height:t.height},this.draggableContext.dropArea=this.getDropColumnArea(e)}isThereCursorInLeftPart(e){if(!this.draggableContext||!this.draggableContext.mouseOverElementRect)return!1;const t=this.draggableContext.mouseOverElementRect;return e.pageX<t.x+t.width/2}updateDraggableElementPosition(){if(!this.draggableContext)return;const e=this.draggableContext;e.draggableElementPosition={x:e.srcHeaderPosition.x+(e.currentCursorPosition.x-e.initialCursorPosition.x)+(e.currentScrollPosition.x-e.initialScrollPosition.x)+e.currentScrollPosition.x,y:e.srcHeaderPosition.y+(e.currentCursorPosition.y-e.initialCursorPosition.y)+(e.currentScrollPosition.y-e.initialScrollPosition.y)+e.currentScrollPosition.y}}addEventSubscriptions(){document.addEventListener("pointermove",this.boundOnDocumentMouseMoveHandler),document.addEventListener("scroll",this.boundOnDocumentScrollHandler),this.addHeaderEventSubscriptions(),this.addGroupPanelEventSubscriptions(),this.addEmptyHeaderCellEventSubscriptions(),this.addGroupContentFreeSpaceElementEventSubscriptions()}addHeaderEventSubscriptions(){const e=this.grid.getHeaderCells();for(let t=0;t<e.length;t++){const n=e[t];n.addEventListener("pointermove",this.boundOnHeaderMouseMoveHandler),n.addEventListener("pointerout",this.boundOnElementToDropMouseOutHandler)}}addEmptyHeaderCellEventSubscriptions(){const e=this.grid.getEmptyHeaderCellContentContainer();e&&this.addPanelElementEventSubscriptions(e,this.boundOnEmptyHeaderCellMouseMoveHandler)}addGroupPanelEventSubscriptions(){if(!this.shouldAddEventListenersToGroupPanel())return;const e=this.grid.getGroupPanelContentContainer();this.addPanelElementEventSubscriptions(e,this.boundOnGroupPanelMouseMoveHandler)}addGroupContentFreeSpaceElementEventSubscriptions(){const e=this.grid.getGroupContentFreeSpaceElement();e&&this.addPanelElementEventSubscriptions(e,this.boundOnGroupFreeSpaceMouseMoveHandler)}addPanelElementEventSubscriptions(e,t){e.addEventListener("pointermove",t),e.addEventListener("pointerout",this.boundOnElementToDropMouseOutHandler)}removeEventSubscriptions(){document.removeEventListener("pointermove",this.boundOnDocumentMouseMoveHandler),document.removeEventListener("scroll",this.boundOnDocumentScrollHandler),this.removeHeaderEventSubscriptions(),this.removeGroupPanelEventSubscriptions(),this.removeEmptyHeaderCellEventSubscriptions(),this.removeGroupContentFreeSpaceElementEventSubscriptions()}removeHeaderEventSubscriptions(){const e=this.grid.getHeaderCells();for(let t=0;t<e.length;t++){const n=e[t];n.removeEventListener("pointermove",this.boundOnHeaderMouseMoveHandler),n.removeEventListener("pointerout",this.boundOnElementToDropMouseOutHandler)}}removeGroupPanelEventSubscriptions(){if(!this.shouldAddEventListenersToGroupPanel())return;const e=this.grid.getGroupPanelContentContainer();this.removePanelElementEventSubscriptions(e,this.boundOnGroupPanelMouseMoveHandler)}removeEmptyHeaderCellEventSubscriptions(){const e=this.grid.getEmptyHeaderCellContentContainer();e&&this.removePanelElementEventSubscriptions(e,this.boundOnEmptyHeaderCellMouseMoveHandler)}removeGroupContentFreeSpaceElementEventSubscriptions(){const e=this.grid.getGroupContentFreeSpaceElement();e&&this.removePanelElementEventSubscriptions(e,this.boundOnGroupFreeSpaceMouseMoveHandler)}removePanelElementEventSubscriptions(e,t){e.removeEventListener("pointermove",t),e.removeEventListener("pointerout",this.boundOnElementToDropMouseOutHandler)}shouldAddEventListenersToGroupPanel(){const e=this.grid.getGroupPanelContentContainer();return!!e&&!(null==e?void 0:e.querySelector(`.${f.HeaderElementClassName}`))}static addDraggableHeaderToDOM(e){const t=document.createElement("div");t.className=`card ${f.DraggableHeaderClassName}`,e.classList.contains(f.SelectionCellClassName)&&t.classList.add(f.SelectionCellClassName),e.classList.contains(f.CommandCellClassName)&&t.classList.add(f.CommandCellClassName),t.style.width=`${e.clientWidth}px`,t.style.height=`${e.clientHeight}px`;const n=getComputedStyle(e);t.style.padding=n.padding,t.style.font=n.font;const i=g.getContentElement(e).cloneNode(!0);return t.appendChild(i),document.body.appendChild(t),t}static removeDraggableHeaderFromDom(){const e=document.querySelectorAll(`.${f.DraggableHeaderClassName}`);for(let t=0;t<e.length;t++)e[t].remove()}static createDraggableContext(e,t,n){const i=v.getDocumentScrollPosition(),o=v.getPointerPosition(n);return{srcHeaderPosition:v.getElementPosition(e),srcHeaderElement:e,headerElement:t,allowGroup:g.allowGroup(e),mouseOverElement:null,mouseOverElementRect:null,isPossibleDropColumn:!1,columnUid:g.getColumnUniqueId(e),beforeColumnUid:null,dropArea:p.Header,initialCursorPosition:o,currentCursorPosition:{x:0,y:0},draggableElementPosition:o,initialScrollPosition:i,currentScrollPosition:i,targets:new b}}clearMoveStateFromDraggableContext(){this.draggableContext&&(this.draggableContext.mouseOverElement=null,this.draggableContext.mouseOverElementRect=null,this.draggableContext.isPossibleDropColumn=!1,this.draggableContext.beforeColumnUid=null)}static getPointerPosition(e){return{x:e.pageX,y:e.pageY}}static getDocumentScrollPosition(){return{x:a.getDocumentScrollLeft(),y:a.getDocumentScrollTop()}}static getElementPosition(e){const{left:t,top:n}=e.getBoundingClientRect();return{x:t,y:n}}}class E{constructor(e){this._startSelectionRowIndex=-1,this._endSelectionRowIndex=-1,this.savedSelectedRowIndexes=[],this.boundOnRowPointerEnterHandler=this.onRowPointerEnter.bind(this),this.grid=e}get startSelectionRowIndex(){return this._startSelectionRowIndex}get endSelectionRowIndex(){return this._endSelectionRowIndex}static getVisibleIndexByTarget(e,t){let n=t;for(;n&&n!==e&&"button"!==n.tagName.toLowerCase()&&"a"!==n.tagName.toLowerCase()&&!n.classList.contains(f.SelectionCellClassName);){if("tr"===n.tagName.toLowerCase()&&n.dataset.visibleIndex)return E.getVisibleIndex(n);n=n.parentElement}return-1}static getVisibleIndex(e){return e.dataset.visibleIndex?parseInt(e.dataset.visibleIndex):-1}startSelectRows(e,t){if(this._startSelectionRowIndex=E.getVisibleIndexByTarget(this.grid,e),this._endSelectionRowIndex=this._startSelectionRowIndex,!t){const e=this.findSelectedRowElements();if(e)for(let t=0;t<e.length;t++)e[t].classList.contains("dxbs-grid-selected-row")&&this.savedSelectedRowIndexes.push(E.getVisibleIndex(e[t]))}this.addRowEventSubscriptions(),this.updateRowsSelection()}stopSelectRows(){this.deselectRows(),this.removeRowEventSubscriptions(),this._startSelectionRowIndex=-1,this._endSelectionRowIndex=-1,this.savedSelectedRowIndexes=[]}findRowElements(){return this.grid.querySelectorAll("tr[data-visible-index]")}findSelectedRowElements(){return this.grid.querySelectorAll("tr.dxbs-grid-selected-row[data-visible-index]")}findRowElement(e){return this.grid.querySelector(`tr[data-visible-index="${e}"]`)}addRowEventSubscriptions(){const e=this.findRowElements();if(e)for(let t=0;t<e.length;t++)e[t].addEventListener("pointerenter",this.boundOnRowPointerEnterHandler)}removeRowEventSubscriptions(){const e=this.findRowElements();if(e)for(let t=0;t<e.length;t++)e[t].removeEventListener("pointerenter",this.boundOnRowPointerEnterHandler)}onRowPointerEnter(e){this._endSelectionRowIndex=E.getVisibleIndexByTarget(this.grid,e.target),this.updateRowsSelection()}selectRows(e,t){for(let n=0;n<e.length;n++){const i=this.findRowElement(e[n]);i&&(i.classList.add("dxbs-grid-selected-row"),!t||0!==n&&n!==e.length-1||i.classList.add("dxbs-grid-touch-row"))}}deselectRows(){const e=this.findRowElements();if(e)for(let t=0;t<e.length;t++)e[t].classList.remove("dxbs-grid-selected-row","dxbs-grid-touch-row");this.selectRows(this.savedSelectedRowIndexes)}updateRowsSelection(){if(-1===this.startSelectionRowIndex||-1===this.endSelectionRowIndex)return;this.deselectRows();const e=Math.min(this.startSelectionRowIndex,this.endSelectionRowIndex),t=Math.max(this.startSelectionRowIndex,this.endSelectionRowIndex),n=Array.from({length:t-e+1},((t,n)=>n+e));this.selectRows(n,!0)}}var x;!function(e){e[e.ModelUpdate=0]="ModelUpdate",e[e.SizeUpdate=1]="SizeUpdate"}(x||(x={}));class S{constructor(e){this.grid=e,this.columnsInfo=[],this.freeColumnIndices=[],this.percentColumnIndeces=[],this.totalAbsoluteWidth=0,this.totalPercentWidth=0,this.totalPercents=0,this.freeCoumnsCount=0,this.excess=0,this.updateMode=x.ModelUpdate}get totalWidth(){let e=0;for(let t=0;t<this.columnsInfo.length;t++){const n=this.columnsInfo[t];e+=n.changedWidth?n.changedWidth:n.currentWidth}return e}correctWidths(e=null){this.updateMode=null===e?x.SizeUpdate:x.ModelUpdate,null!=e&&(this.columnsInfo=e),0!==this.columnsInfo.length&&requestAnimationFrame((()=>{const e=this.grid.getColElements();this.resetColumnWidths(e),this.collectInfo(),this.distributeExcess(),this.applyChangedWidths(e)}))}resetColumnWidths(e){for(let t=0;t<e.length;t++)this.columnsInfo.length>0&&!this.columnsInfo[t].IsIndent&&!this.columnsInfo[t].IsEmpty&&(this.columnsInfo[t].changedWidth=0,this.updateMode===x.ModelUpdate&&this.repairStyle(e[t],t))}collectInfo(){this.clearInfo(),this.updateMode===x.ModelUpdate&&this.getCurrentWidths(),this.updateMode===x.SizeUpdate&&this.calculateCurrentWidths();for(let e=0;e<this.columnsInfo.length;e++){const t=this.columnsInfo[e];t.IsIndent||t.IsEmpty||(t.correctWidthByMinValue()&&(this.excess+=t.changedWidth-t.currentWidth),t.IsFree&&this.freeColumnIndices.push(e),t.IsPercent&&(this.totalPercentWidth+=t.currentWidth,this.percentColumnIndeces.push(e)))}}clearInfo(){this.freeColumnIndices=[],this.percentColumnIndeces=[],this.totalPercentWidth=0,this.excess=0,this.updateMode===x.ModelUpdate&&(this.totalAbsoluteWidth=0,this.freeCoumnsCount=0,this.totalPercents=0)}getCurrentWidths(){const e=this.grid.getHeaderRow();if(!e)return;const t=e.cells;for(let e=0;e<this.columnsInfo.length;e++){const n=this.columnsInfo[e];n.currentWidth=n.firstRenderWidth=t[e].offsetWidth,n.IsPercent?this.totalPercents+=n.getPercents():n.isFixed||n.IsIndent?this.totalAbsoluteWidth+=n.firstRenderWidth:n.IsFree&&(this.freeCoumnsCount+=1)}}calculateCurrentWidths(){var e;const t=(null===(e=this.grid.getTableContainer())||void 0===e?void 0:e.offsetWidth)||0,n=this.totalAbsoluteWidth;let i=t*this.totalPercents/100;i>t-n&&(i=Math.max(0,t-n));const o=Math.max(0,t-n-i);for(let e=0;e<this.columnsInfo.length;e++){const t=this.columnsInfo[e];t.IsPercent?t.currentWidth=i*t.getPercents()/this.totalPercents:t.isFixed||t.IsIndent?t.currentWidth=t.firstRenderWidth:t.IsFree?t.currentWidth=o/this.freeCoumnsCount:t.IsEmpty&&(t.currentWidth=o)}}distributeExcess(){if(this.excess>0){this.sortIndices(this.freeColumnIndices,0),this.distributeExcessToFreeColumns();const e=this.columnsInfo[this.columnsInfo.length-1];e.IsEmpty&&(this.excess-=e.currentWidth),this.excess>0&&(this.sortIndices(this.percentColumnIndeces,this.excess/this.totalPercentWidth),this.distributeExcessToPercentColumns())}}sortIndices(e,t){e.sort(((e,n)=>{const i=this.columnsInfo[e],o=this.columnsInfo[n];return o.currentWidth-o.minWidth-o.currentWidth*t-(i.currentWidth-i.minWidth-i.currentWidth*t)>0?-1:1}))}distributeExcessToFreeColumns(){for(let e=0;e<this.freeColumnIndices.length;e++){this.excess-=this.columnsInfo[this.freeColumnIndices[e]].distributeExcess(this.excess/(this.freeColumnIndices.length-e))}}distributeExcessToPercentColumns(){for(let e=0;e<this.percentColumnIndeces.length;e++){const t=this.columnsInfo[this.percentColumnIndeces[e]];this.excess-=t.distributeExcess(this.excess*t.currentWidth/this.totalPercentWidth),this.totalPercentWidth-=t.currentWidth}}applyChangedWidths(e){for(let t=0;t<this.columnsInfo.length;t++){const n=this.columnsInfo[t].changedWidth;n?e[t].style.width=`${n}px`:this.updateMode===x.SizeUpdate&&this.repairStyle(e[t],t)}}repairStyle(e,t){e.style.width=this.columnsInfo[t].isFixed?this.columnsInfo[t].initWidth:""}}class H extends c{constructor(e){super(),this.grid=e}buildStyleSheetCore(){const e=this.grid.getCardContainer(),t=this.getBackgroundColorByElement(e),n=this.getBorderByElement(e,"border-top"),i=this.getBorderByElement(e,"border-bottom"),o=this.getTableBorderWidth();return`\n::slotted(div.card) {\n    ${this.getContainerColorVarDeclaration(t)}\n    ${this.getHeaderColorVarDeclaration(t)}\n    ${this.getGroupFooterColorVarDeclaration(t)}\n    ${this.getFooterColorVarDeclaration(t)}\n    ${this.getSelectionColorVarDeclaration(t)}\n    ${this.getTouchColorVarDeclaration(t)}\n    ${this.getCardBorderTopVarDeclaration(n)}\n    ${this.getCardBorderBottomVarDeclaration(i)}\n    ${this.getTableBorderWidthVarDeclaration(o)}\n}\n`}getBorderByElement(e,t){if(!e)return"";const n=getComputedStyle(e);let i=n.getPropertyValue(t);return i||(i=n.getPropertyValue(t+"-width")+" "+n.getPropertyValue(t+"-style")+" "+n.getPropertyValue(t+"-color")),i}getBorderWidthByElement(e){if(!e)return 1;const t=getComputedStyle(e);return parseFloat(t.borderBottomWidth)||parseFloat(t.borderWidth)}getTableBorderWidth(){return this.getElementValue((e=>e.className="table table-bordered"),(e=>this.getBorderWidthByElement(e)))}getContainerColorVarDeclaration(e){return this.getLightMixedColorVarDeclaration("--dx-grid-container-color",e,0)}getHeaderColorVarDeclaration(e){return this.useBlackMixColor(e)?this.getBlackMixedColorVarDeclaration("--dx-grid-header-color",e,.2):this.getLightMixedColorVarDeclaration("--dx-grid-header-color",e,.5)}getGroupFooterColorVarDeclaration(e){return this.useBlackMixColor(e)?this.getBlackMixedColorVarDeclaration("--dx-grid-group-footer-color",e,.1):this.getLightMixedColorVarDeclaration("--dx-grid-group-footer-color",e,.2)}getFooterColorVarDeclaration(e){return this.useBlackMixColor(e)?this.getBlackMixedColorVarDeclaration("--dx-grid-footer-color",e,.12):this.getLightMixedColorVarDeclaration("--dx-grid-footer-color",e,.5)}getSelectionColorVarDeclaration(e){return this.useBlackMixColor(e)?this.getBlackMixedColorVarDeclaration("--dx-grid-selection-color",e,.25):this.getLightMixedColorVarDeclaration("--dx-grid-selection-color",e,.95)}getTouchColorVarDeclaration(e){return this.useBlackMixColor(e)?this.getBlackMixedColorVarDeclaration("--dx-grid-touch-color",e,.5):this.getDarkMixedColorVarDeclaration("--dx-grid-touch-color",e,.2)}getTableBorderWidthVarDeclaration(e){return`--dx-grid-table-border-bottom-width: ${e}px;`}getCardBorderTopVarDeclaration(e){return`--dx-grid-border-top: ${e};`}getCardBorderBottomVarDeclaration(e){return`--dx-grid-border-bottom: ${e};`}getLightMixedColorVarDeclaration(e,t,n){return c.getMixedColorVarDeclaration(e,t,this.lightColor,n)}getDarkMixedColorVarDeclaration(e,t,n){return c.getMixedColorVarDeclaration(e,t,this.darkColor,n)}getBlackMixedColorVarDeclaration(e,t,n){return c.getMixedColorVarDeclaration(e,t,0,n)}}class f{}f.ClassName="dxbs-grid",f.DataTableClassName=f.ClassName+"-table",f.GroupPanelContentContainerClassName=f.ClassName+"-group-panel-content-container",f.EmptyHeaderCellContentContainerClassName=f.ClassName+"-empty-header",f.GroupContentFreeSpaceClassName=f.ClassName+"-group-content-free-space",f.HeaderRowClassName=f.ClassName+"-header-row",f.FilterRowClassName=f.ClassName+"-filter-row",f.FooterRowClassName=f.ClassName+"-footer-row",f.PagerRowClassName=f.ClassName+"-pager-row",f.HeaderElementClassName=f.ClassName+"-header",f.HeaderContentClassName=f.ClassName+"-header-content",f.AllowDragClassName=f.ClassName+"-action",f.DraggableHeaderClassName=f.ClassName+"-draggable-header",f.SelectionCellClassName=f.ClassName+"-selection-cell",f.CommandCellClassName=f.ClassName+"-command-cell",f.MoveCursorCssClassName=f.ClassName+"-move-cursor",f.DraggingDownTargetClassName=f.ClassName+"-dragging-down-target",f.DraggingUpTargetClassName=f.ClassName+"-dragging-up-target",f.CardContainerClassName="card",f.TableContainerClassName="dxbs-scroll-viewer-content";const w=document.createElement("template");w.innerHTML="\n<style></style>\n<slot />";const P="dxbl-grid";class D extends n{constructor(){var e;super(),this.selectionHelper=null,this._allowSelectRowByClick=!1,this._enableMultiSelect=!1,this.prevClickedRowVisibleIndex=-1,this.boundOnStartSelectionHandler=this.onStartSelection.bind(this),this.boundOnStopSelectionHandler=this.onStopSelection.bind(this),this.boundOnCancelSelectionHandler=this.onCancelSelection.bind(this),this.boundOnClickHandler=this.onClick.bind(this),this.boundOnCellPointerOverHandler=this.onCellPointerOver.bind(this),this.startDraggingPixelLimit=4,this.isLastMouseClickWasRaisedAfterDrag=!1,this.dragging=new v(this),this.columnWidthsController=new S(this),this.boundOnHeaderCellPointerUpHandler=this.onHeaderCellPointerUp.bind(this),this.boundOnHeaderCellPointerCancelHandler=this.onHeaderCellPointerCancel.bind(this),this.boundOnHeaderCellPointerDownHandler=this.onHeaderCellPointerDown.bind(this),this.boundOnHeaderCellPointerMoveHandler=this.onHeaderCellPointerMove.bind(this),this.boundOnHeaderCellClickHandler=this.onHeaderCellClickHandler.bind(this),this.boundOnHeaderCellKeyDownHandler=this.onHeaderCellKeyDownHandler.bind(this),this.resizeObserver=new ResizeObserver(this.onSizeChanged.bind(this)),this.isolatedStyleElement=null===(e=this.shadowRoot)||void 0===e?void 0:e.querySelector("style"),this.isInitResize=!0,this.isHoverableDevice=!1}initializeComponent(){super.initializeComponent(),this.isHoverableDevice=class{static isHoverableDevice(){return window.matchMedia("(hover: hover) and (pointer: fine)").matches}}.isHoverableDevice(),this.uiHandlersBridge=this.querySelector(t),this.buildIsolateStyles(),this.addEventSubscriptions(),this.resizeObserver.observe(this)}disposeComponent(){this.removeEventSubscriptions(),this.resizeObserver.disconnect(),delete this.uiHandlersBridge,super.disposeComponent()}getDataTable(){return this.querySelector(`.${f.DataTableClassName}`)}getHeaderRow(){return this.querySelector(`thead > tr.${f.HeaderRowClassName}`)}getFilterRow(){return this.querySelector(`thead > tr.${f.FilterRowClassName}`)}getHeaderCells(){return this.querySelectorAll(`.${f.HeaderElementClassName}`)}getGroupPanelContentContainer(){return this.querySelector(`.${f.GroupPanelContentContainerClassName}`)}getEmptyHeaderCellContentContainer(){return this.querySelector(`.${f.EmptyHeaderCellContentContainerClassName}`)}getGroupContentFreeSpaceElement(){return this.querySelector(`.${f.GroupContentFreeSpaceClassName}`)}getColElements(){return this.querySelectorAll("col")}getFooterRow(){return this.querySelector(`.${f.FooterRowClassName}`)}getCardContainer(){return this.querySelector(`.${f.CardContainerClassName}`)}getPagerRow(){return this.querySelector(`.${f.PagerRowClassName}`)}getTableContainer(){return this.querySelector(`.${f.TableContainerClassName}`)}addEventSubscriptions(){this.addEventListener(i.eventName,this.boundOnStartSelectionHandler),this.addEventListener(o.eventName,this.boundOnStopSelectionHandler),this.addEventListener(r.eventName,this.boundOnCancelSelectionHandler),this.addEventListener(s.eventName,this.boundOnClickHandler),this.isHoverableDevice&&this.addEventListener("pointerover",this.boundOnCellPointerOverHandler)}removeEventSubscriptions(){this.removeEventListener(i.eventName,this.boundOnStartSelectionHandler),this.removeEventListener(o.eventName,this.boundOnStopSelectionHandler),this.removeEventListener(r.eventName,this.boundOnCancelSelectionHandler),this.removeEventListener(s.eventName,this.boundOnClickHandler),this.isHoverableDevice&&this.removeEventListener("pointerover",this.boundOnCellPointerOverHandler)}onStartSelection(e){this.selectionHelper=new E(this),this.selectionHelper.startSelectRows(e.detail.source.target,!(e.detail.source.ctrlKey||e.detail.source.metaKey||e.detail.isLongTap))}onStopSelection(e){if(null!==this.selectionHelper){if(this.uiHandlersBridge&&this.selectionHelper.startSelectionRowIndex>-1&&this.selectionHelper.endSelectionRowIndex>-1){this.uiHandlersBridge.send("rowClicked",{visibleIndex:this.selectionHelper.endSelectionRowIndex,prevVisibleIndex:this.selectionHelper.startSelectionRowIndex,ctrlKey:e.detail.source.ctrlKey||e.detail.source.metaKey||e.detail.isLongTap,shiftKey:this.selectionHelper.endSelectionRowIndex!==this.selectionHelper.startSelectionRowIndex})}this.selectionHelper.stopSelectRows(),this.selectionHelper=null}}onCancelSelection(e){null!==this.selectionHelper&&(this.selectionHelper.stopSelectRows(),this.selectionHelper=null)}onClick(e){const t=E.getVisibleIndexByTarget(this,e.detail.source.target);if(this.uiHandlersBridge&&t>-1){const n={visibleIndex:t,prevVisibleIndex:this.prevClickedRowVisibleIndex,ctrlKey:e.detail.source.ctrlKey||e.detail.source.metaKey,shiftKey:e.detail.source.shiftKey};this.uiHandlersBridge.send("rowClicked",n),n.shiftKey||(this.prevClickedRowVisibleIndex=t)}}get allowSelectRowByClick(){return this._allowSelectRowByClick}set allowSelectRowByClick(e){this._allowSelectRowByClick=e,this.updateHandlePointerEventsMode()}get enableMultiSelect(){return this._enableMultiSelect}set enableMultiSelect(e){this._enableMultiSelect=e,this.updateHandlePointerEventsMode()}updateHandlePointerEventsMode(){this.handlePointerEventsMode=this.allowSelectRowByClick?d.TouchUI&&this.enableMultiSelect?l.ClickAndDragging:l.Click:l.None}notifyHeaderAdded(t){t.addEventListener("pointerdown",this.boundOnHeaderCellPointerDownHandler),document.addEventListener("pointermove",this.boundOnHeaderCellPointerMoveHandler),document.addEventListener("pointerup",this.boundOnHeaderCellPointerUpHandler),t.addEventListener("gotpointercapture",D.onHeaderCellGotPointerCapture),t.addEventListener("pointercancel",this.boundOnHeaderCellPointerCancelHandler),t.addEventListener(e.touchMouseDownEventName,n.preventDefaultBrowserBehaviour),t.addEventListener("click",this.boundOnHeaderCellClickHandler),document.addEventListener("keydown",this.boundOnHeaderCellKeyDownHandler)}notifyHeaderRemoved(t){t.removeEventListener("pointerdown",this.boundOnHeaderCellPointerDownHandler),document.removeEventListener("pointermove",this.boundOnHeaderCellPointerMoveHandler),document.removeEventListener("pointerup",this.boundOnHeaderCellPointerUpHandler),t.removeEventListener("gotpointercapture",D.onHeaderCellGotPointerCapture),t.removeEventListener("pointercancel",this.boundOnHeaderCellPointerCancelHandler),t.removeEventListener(e.touchMouseDownEventName,n.preventDefaultBrowserBehaviour),t.removeEventListener("click",this.boundOnHeaderCellClickHandler),document.removeEventListener("keydown",this.boundOnHeaderCellKeyDownHandler)}notifyColumnsChanged(e){this.columnWidthsController.correctWidths(e)}onHeaderCellPointerDown(e){if(0!==e.button)return;const t=g.findHeaderElement(e.target);t&&g.allowDrag(t)&&(this.pointerDownEvent=e,this.pointerDownElement=t,this.isLastMouseClickWasRaisedAfterDrag=!1)}onHeaderCellPointerMove(e){this.pointerDownElement&&this.pointerDownEvent&&(Math.abs(this.pointerDownEvent.pageX-e.pageX)>this.startDraggingPixelLimit||Math.abs(this.pointerDownEvent.pageY-e.pageY)>this.startDraggingPixelLimit)&&(this.startDragging(this.pointerDownElement,this.pointerDownEvent),this.clearPointerDownInfo(),this.isLastMouseClickWasRaisedAfterDrag=!0)}static onHeaderCellGotPointerCapture(e){const t=e.target;t&&t.hasPointerCapture(e.pointerId)&&t.releasePointerCapture(e.pointerId)}onHeaderCellClickHandler(e){0===e.button&&this.isLastMouseClickWasRaisedAfterDrag&&e.stopPropagation()}onHeaderCellKeyDownHandler(e){if("Escape"===e.key&&this.dragging.isStarted()&&(this.stopDragging(),this.clearPointerDownInfo()),"Enter"===e.key||" "===e.key){const t=g.findHeaderElement(e.target);t&&this.onColumnHeaderClicked(t,e.ctrlKey||e.metaKey,e.shiftKey)}}onHeaderCellPointerUp(e){if(this.dragging.isStarted())this.onColumnMoved(),this.stopDragging();else{const t=g.findHeaderElement(e.target);this.pointerDownElement&&this.pointerDownElement===t&&(g.allowSort(t)?this.onColumnHeaderClicked(this.pointerDownElement,e.ctrlKey||e.metaKey,e.shiftKey):"touch"===e.pointerType&&t.click())}this.clearPointerDownInfo()}onCellPointerOver(e){const t=e.target;t&&(t.offsetWidth<t.scrollWidth?t.setAttribute("title",t.innerText):t.removeAttribute("title"))}onColumnMoved(){const e=this.dragging.createColumnMovedHandlerArgs();e&&this.uiHandlersBridge&&this.uiHandlersBridge.send("columnMoved",e)}onColumnHeaderClicked(e,t,n){const i={columnUid:g.getColumnUniqueId(e),ctrlKey:t,shiftKey:n};this.uiHandlersBridge&&this.uiHandlersBridge.send("columnHeaderClicked",i)}onHeaderCellPointerCancel(e){this.stopDragging(),this.clearPointerDownInfo()}onSizeChanged(e){if(this.isInitResize)this.isInitResize=!1;else{e[0].contentRect.width-this.getHorizontalBordersWidth()!==this.columnWidthsController.totalWidth&&this.columnWidthsController.correctWidths()}}getHorizontalBordersWidth(){const e=a.getCurrentStyle(this.getCardContainer());return a.pxToInt(e.borderLeftWidth)+a.pxToInt(e.borderRightWidth)}startDragging(e,t){this.dragging.start(e,t),document.addEventListener("touchmove",n.preventDefaultBrowserBehaviour,{passive:!1})}stopDragging(){document.removeEventListener("touchmove",n.preventDefaultBrowserBehaviour),this.dragging.stop()}clearPointerDownInfo(){this.pointerDownEvent=void 0,this.pointerDownElement=void 0}getContentTemplate(){return w}buildIsolateStyles(){new H(this).buildStyleSheet(this.isolatedStyleElement)}static get observedAttributes(){return["allow-select-row-by-click","enable-multi-select"]}attributeChangedCallback(e,t,n){switch(e){case"allow-select-row-by-click":this.allowSelectRowByClick=null!==n;break;case"enable-multi-select":this.enableMultiSelect=null!==n}}}customElements.define(P,D),customElements.define("dxbl-grid-header-content",class extends n{constructor(){super()}initializeComponent(){super.initializeComponent(),this.grid=this.closest(P),this.headerElement=this.closest(`.${f.HeaderElementClassName}`),this.isPossibleNotifyGrid()&&this.grid.notifyHeaderAdded(this.headerElement)}disposeComponent(){var e;super.disposeComponent(),this.isPossibleNotifyGrid()&&(null===(e=this.grid)||void 0===e||e.notifyHeaderRemoved(this.headerElement)),this.grid=void 0,this.headerElement=void 0}isPossibleNotifyGrid(){return!(!this.grid||!this.headerElement)}}),customElements.define("dxbl-grid-columns-info",class extends n{constructor(){super()}get columns(){return this.getAttribute("columns")}initializeComponent(){super.initializeComponent(),this.grid=this.closest(P),null!==this.columns&&this.grid.notifyColumnsChanged(this.parseColumns(this.columns))}parseColumns(e){const t=JSON.parse(e),n=[];for(let e=0;e<t.length;e++){const i=new u(t[e].Width,t[e].MinWidth,t[e].IsIndent,t[e].IsEmpty);n.push(i)}return n}static get observedAttributes(){return["columns"]}attributeChangedCallback(e,t,n){var i;null===(i=this.grid)||void 0===i||i.notifyColumnsChanged(this.parseColumns(n))}});const y={loadModule:function(){}};export{D as DxGrid,P as DxGridTagName,f as GridCssClasses,y as default};

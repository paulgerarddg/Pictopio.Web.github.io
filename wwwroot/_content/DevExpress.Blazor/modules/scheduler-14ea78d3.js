import{D as t,B as e}from"./dom-b082d2b1.js";import{E as i}from"./evt-dd6ca95c.js";import{D as n}from"./dx-html-element-base-de595fb7.js";import{DxUIHandlersBridgeTagName as s}from"./dx-ui-handlers-bridge-4076ae57.js";import{d as o,C as l,D as r,E as a,m as c,l as p,F as h,G as u,u as d,f as m}from"./dom-utils-8b753f73.js";import{T as f}from"./touch-a0ef8cac.js";import{d as g}from"./popuproot-e58b0e44.js";import{P as v}from"./positiontrackerobserver-5fd93b2c.js";import"./_tslib-1f2a369a.js";import"./data-qa-utils-8be7c726.js";import"./branch-a902b7e1.js";import"./property-d63bb995.js";import"./capturemanager-f28d279d.js";import"./eventhelper-dec6cde0.js";import"./rafaction-bba7928b.js";import"./rect-2684652a.js";import"./point-9c6ab88a.js";import"./layouthelper-c2462bd3.js";const A={};function T(t,e,i,n){n&&C(e)&&b(e),void 0===A[e]&&(A[e]=setTimeout((()=>{t(),delete A[e]}),i))}function C(t){return!!A[t]}function b(t){clearTimeout(A[t]),delete A[t]}class y{static attachLongTabEventToElement(t,e){y.longTabHandler=e,y.attachEventToElement(t,"touchstart",y.onTouchStart,"ts"),y.attachEventToElement(t,"touchend",y.onTouchEnd,"te"),y.attachEventToElement(t,"touchmove",y.onTouchMove,"tm")}static attachEventToElement(t,e,i,n){t[n=n||i.name]||(t[n]=i),t.removeEventListener(e,i=t[n]),t.addEventListener(e,i)}static onTouchStart(t){y.validEvent(t)&&(y.touchCount++,T((()=>{y.longTouchFireAsync(t)}),"longPress",y.longTouchTimeout,!0))}static onTouchEnd(t){y.validEvent(t)&&(y.touchCount=0,b("longPress"))}static onTouchMove(t){C("longPress")&&(y.touchCount=0,b("longPress"))}static validEvent(t){return t.timeStamp!==y.lastTimeStamp&&(y.lastTimeStamp=t.timeStamp,!0)}static longTouchFireAsync(t){1===y.touchCount&&(y.touchCount=0,y.longTabHandler&&y.longTabHandler.call(this,t))}}y.longTouchTimeout=500,y.longTabHandler=null,y.touchCount=0,y.lastTimeStamp=null;var H,I;!function(t){t[t.Horizontal=0]="Horizontal",t[t.Vertical=1]="Vertical"}(H||(H={})),function(t){t[t.None=0]="None",t[t.AppointmentEditForm=1]="AppointmentEditForm",t[t.AppointmentCompactEditForm=2]="AppointmentCompactEditForm",t[t.AppointmentToolTip=3]="AppointmentToolTip",t[t.RecurrentAppointmentEditForm=4]="RecurrentAppointmentEditForm",t[t.RecurrentAppointmentDeleteForm=5]="RecurrentAppointmentDeleteForm",t[t.GotoDateForm=6]="GotoDateForm"}(I||(I={}));class w{getContainerIndex(t){return w.getAttributeIntValue(t,"data-container-index",-1)}getFirstContainerIndex(t){return w.getAttributeIntValue(t,"data-first-container-index",-1)}getLastContainerIndex(t){return w.getAttributeIntValue(t,"data-last-container-index",-1)}getAppointmentFirstCellIndex(t){return w.getAttributeIntValue(t,"data-first-cell-index",-1)}getAppointmentLastCellIndex(t){return w.getAttributeIntValue(t,"data-last-cell-index",-1)}getAppointmentColumnsCount(t){return w.getAttributeIntValue(t,"data-columns-count",0)}setAppointmentColumnsCount(t,e){t.setAttribute("data-columns-count",e)}getAppointmentColumn(t){return w.getAttributeIntValue(t,"data-column",0)}setAppointmentColumn(t,e){t.setAttribute("data-column",e)}getAppointmentRow(t){return w.getAttributeFloatValue(t,"data-row",-1)}getAppointmentRowSpan(t){return w.getAttributeFloatValue(t,"data-row-span",0)}getAppointmentKey(t){return t.getAttribute("data-key")||""}getStart(t){const e=new Date(parseInt(t.getAttribute("data-start")||"")),i=e.getTime()+6e4*e.getTimezoneOffset();return new Date(i)}getEnd(t){const e=new Date(parseInt(t.getAttribute("data-end")||"")),i=e.getTime()+6e4*e.getTimezoneOffset();return new Date(i)}getDuration(t){return parseInt(t.getAttribute("data-duration")||"")}getAllDay(t){return""===t.getAttribute("data-allday")}getResourceKey(t){return t.getAttribute("data-resource")||""}static getAttributeIntValue(t,e,i){return w.getAttributeParsedNumberValue(t,e,parseInt,i)}static getAttributeFloatValue(t,e,i){return w.getAttributeParsedNumberValue(t,e,parseFloat,i)}static getAttributeParsedNumberValue(t,e,i,n){const s=t.getAttribute(e);return s?i(s):n}}class S{static getVerticalAppointmentsContainer(t){return t.querySelectorAll(".dxbs-sc-vertical-apts")[0]}static getHorizontalAppointmentsContainer(t){return t.querySelectorAll(".dxbs-sc-horizontal-apts")[0]}static getHorizontalAppointments(t){const e=t.querySelectorAll(".dxbs-sc-horizontal-apt");return Array.from(e)}static getHorizontalEditableAppointments(t){const e=t.querySelectorAll(".dxbs-sc-horizontal-apt.dxbs-apt-edited");return Array.from(e)}static getVerticalAppointments(t){const e=t.querySelectorAll(".dxbs-sc-vertical-apt");return Array.from(e)}static getVerticalEditableAppointments(t){const e=t.querySelectorAll(".dxbs-sc-vertical-apt.dxbs-apt-edited");return Array.from(e)}static getHorizontalView(t){return t.querySelectorAll(".dxbs-sc-horizontal-view")[0]}static getTimeMarkerWrappers(t){return t.querySelectorAll(".dxbs-sc-time-marker-wrapper")}static getTimeMarkerContainer(t){return t.querySelectorAll(".dxbs-sc-time-marker")[0]}static getTimeMarkerImages(t){const e=t.querySelectorAll(".dxbs-sc-time-marker-image");return Array.from(e)}static getTimeMarkerLine(t){return t.querySelectorAll(".dxbs-sc-time-marker-line")[0]}static getTimeIndicatorContainer(t){return t.querySelectorAll(".dxbs-sc-time-indicator")[0]}static getAppointmentContainer(t){return o(t,"dxbs-sc-apt")}static getTimeCellContainer(t){return l(t,"",(function(t,e){return S.isTimeCellElement(t)}))}static getSelectedAppointment(t){return t.querySelectorAll(".dxbs-apt-selected:not(.dxbs-apt-disable)")[0]}static getEditableAppointments(t){const e=t.querySelectorAll(".dxbs-apt-edited");return Array.from(e)}static isEditableAppointment(e){return t.hasClassName(e,"dxbs-apt-edited")}static getCellSelectionContainer(t){return t.querySelectorAll(".dxsc-cell-selection")[0]}static getVerticalResourceHeaders(t){return t.querySelectorAll(".dxsc-v-resource-header")}static getResourcesViewport(t){return t.querySelectorAll(".dxbs-sc-resources-container")[0]}static getTimescaleViewport(t){return t.querySelectorAll(".dxbs-sc-headers-container")[0]}static getTimeCellsViewport(t){return t.querySelectorAll(".dxbs-sc-timecells-container")[0]}static getParentTimeCellsViewport(t){return o(t,"dxbs-sc-timecells-container")}static getHorizontalScrollSpacer(t){return t.querySelectorAll(".dxbs-sc-h-scroll-spacer")[0]}static getVerticalScrollSpacer(t){return t.querySelectorAll(".dxbs-sc-v-scroll-spacer")[0]}static isVerticalAppointment(e){return t.hasClassName(e,"dxbs-sc-vertical-apt")}static isHorizontalAppointment(e){return t.hasClassName(e,"dxbs-sc-horizontal-apt")}static isTimeCellElement(e){return t.hasClassName(e,"dxbs-sc-all-day-area")||t.hasClassName(e,"dxbs-sc-time-cell")}static isTimelineView(e){return t.hasClassName(e,"dxbs-sc-timeline")}static isTopHandleElement(e){return t.hasClassName(e,"dxsc-top-handle")}static isBottomHandleElement(e){return t.hasClassName(e,"dxsc-bottom-handle")}static isLeftHandleElement(e){return t.hasClassName(e,"dxsc-left-handle")}static isRightHandleElement(e){return t.hasClassName(e,"dxsc-right-handle")}static isAppointmentSelected(e){return t.hasClassName(e,"dxbs-apt-selected")}static isDateCellHeader(e){return t.hasClassName(e,"dxsc-date-cell-head")}}S.Attr=new w;class E{constructor(t,e){this._element=t,this._cellSelector=e,this.containers=null,this.timeCells=null}get element(){return this._element}get cellSelector(){return this._cellSelector}getContainers(){if(!this.containers){const t=this.getTimeCells();this.containers={};for(let e,i=0;e=t[i];i++){const t=S.Attr.getContainerIndex(e);this.containers[t]||(this.containers[t]={cells:[]}),this.containers[t].cells.push(e)}}return this.containers}clearObjects(){this.timeCells=null,this.containers=null}getTimeCells(){return this.timeCells||(this.timeCells=this.element.querySelectorAll(this.cellSelector)),this.timeCells}getFirstContainer(){const t=this.getContainers();for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return t[e]}findCell(t){const e=this.getContainers();for(const i in e)if(Object.prototype.hasOwnProperty.call(e,i))for(let n,s=0;n=e[i].cells[s];s++){const e=S.Attr.getStart(n),i=S.Attr.getEnd(n);if(e.valueOf()-t.valueOf()<=0&&t.valueOf()-i.valueOf()<0)return n}return null}findStartCell(t){const e=this.getContainers();for(const i in e)if(Object.prototype.hasOwnProperty.call(e,i))for(let n,s=0;n=e[i].cells[s];s++){const e=S.Attr.getStart(n);if(t.valueOf()-e.valueOf()<=0)return n}return null}findEndCell(t){const e=this.getContainers();for(const i in e)if(Object.prototype.hasOwnProperty.call(e,i))for(let n,s=0;n=e[i].cells[s];s++){const e=S.Attr.getEnd(n);if(t.valueOf()-e.valueOf()<=0)return n}return null}findCellByPos(t,e){const i=this.getTimeCells();for(let n,s=0;n=i[s];s++){const i=n.getBoundingClientRect();if(i.top<=e&&e<i.bottom&&i.left<=t&&t<i.right)return n}return null}}class x{constructor(t,e){this.start=t,this.duration=e,this.isLongerOrEqualDay=e>=z.DaySpan}getStart(){return this.start}getDuration(){return this.duration}getEnd(){return z.addTimeSpan(this.start,this.duration)}intersectsWith(t){return t.getEnd().valueOf()-this.getStart().valueOf()>=0&&t.getStart().valueOf()-this.getEnd().valueOf()<=0}}class O{constructor(t,e,i){this.id=t,this.views=e,this.interval=i,this.allDay=S.Attr.getAllDay(e[0]),this.resourceKey=S.Attr.getResourceKey(e[0]),this.sourceView=this.views[0].cloneNode(!0),this.aptCont=this.views[0].parentElement}getStart(){return this.interval.start}getDuration(){return this.interval.duration}getEnd(){return z.dateIncreaseWithUtcOffset(this.getStart(),this.getDuration())}clearViews(){this.views.forEach((t=>{t.parentElement&&t.parentElement.removeChild(t)})),this.views=[]}static createItem(t,e){return new O(t,e,O.getAppointmentInterval(e))}static getAppointmentInterval(t){const e=S.Attr.getStart(t[0]),i=S.Attr.getDuration(t[0]);return new x(e,i)}static createItems(t){const e={};for(let i,n=0;i=t[n];n++){const t=S.Attr.getAppointmentKey(i);e[t]||(e[t]=[]),e[t].push(i)}const i=[];for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&i.push(O.createItem(t,e[t]));return i}}class z{static dateSubsWithTimezone(t,e){return t.valueOf()-e.valueOf()+6e4*(e.getTimezoneOffset()-t.getTimezoneOffset())}static truncToDate(t){return new Date(t.getFullYear(),t.getMonth(),t.getDate())}static calculateDaysDifference(t,e){const i=z.truncToDate(t),n=z.truncToDate(e);return z.dateSubsWithTimezone(n,i)/z.DaySpan}static dateIncreaseWithUtcOffset(t,e){const i=z.dateIncrease(t,e),n=6e4*(i.getTimezoneOffset()-t.getTimezoneOffset());return z.dateIncrease(i,n)}static dateIncrease(t,e){return new Date(t.valueOf()+e)}static addTimeSpan(t,e){return new Date(t.valueOf()+e)}static toDayTime(t){return t.valueOf()-z.truncToDate(t).valueOf()}static getCellInterval(t){const e=S.Attr.getStart(t),i=S.Attr.getEnd(t);return new x(e,i.valueOf()-e.valueOf())}}z.HalfHourSpan=18e5,z.DaySpan=864e5;class V{constructor(t,e){this.scheduler=t,this.uiHandlersBridge=e,this.appointmentInfo=null,this.sourceAppointmentInfo=null,this.interval=null,this.startCellInfo=null,this.currentCellInfo=null,this.dateDiff=0,this.horizontalAppointmentDragged=!1,this.lastCellChanged=!1,this.initialPageY=0,this.initialTop=0,this.initialScrollTop=0,this.lastTop=0,this.lastCell=null}dragStart(t,e,i){var n;this.appointmentInfo=new O(t.id,t.views,t.interval),this.sourceAppointmentInfo=t,this.startCellInfo=e,this.currentCellInfo=e,this.dateDiff=t.getStart().valueOf()-e.interval.start.valueOf();const s=this.findAppointmentViewByInterval(this.appointmentInfo.views,e.interval);this.horizontalAppointmentDragged=e.layoutType===H.Horizontal,this.initialTop=s.offsetTop,this.initialPageY=i.pageY,this.lastTop=this.initialTop,this.lastCell=e.cell,this.initialScrollTop=this.getViewportScrollTop(),this.saveAppointmentTopPositionInfo(i),null===(n=this.uiHandlersBridge)||void 0===n||n.send("startDragAppointment","")}drag(t,e){var i,n;if(!(this.startCellInfo&&this.currentCellInfo&&this.appointmentInfo&&this.sourceAppointmentInfo))return;const s=this.currentCellInfo.interval;this.lastCellChanged=!1,this.updateEditedAppointmentPosition(e);const o=t.cell;if(this.lastCellChanged=this.lastCell!==o,this.lastCell=o,t.layoutType===H.Horizontal&&!this.horizontalAppointmentDragged){const t=(null===(i=o.offsetParent)||void 0===i?void 0:i.getBoundingClientRect().top)||0;this.initialTop=e.clientY-t,this.initialPageY=e.pageY,this.initialScrollTop=this.getViewportScrollTop(o),this.lastTop=this.initialTop}const l=t.interval;if(s.start.valueOf()-l.start.valueOf()==0&&s.duration===l.duration){const t=S.Attr.getResourceKey(o);if(!this.appointmentInfo.resourceKey||this.appointmentInfo.resourceKey===t)return}this.currentCellInfo.allDay!==t.allDay?(this.dateDiff=0,this.appointmentInfo.interval=t.allDay?this.sourceAppointmentInfo.allDay?new x(l.start,this.sourceAppointmentInfo.interval.duration):l:this.startCellInfo.allDay?l:new x(l.start,this.sourceAppointmentInfo.interval.duration),this.appointmentInfo.allDay=t.allDay):this.appointmentInfo.interval=new x(z.addTimeSpan(l.start,this.dateDiff||0),this.appointmentInfo.interval.duration),this.updateResource(o),this.saveAppointmentTopPositionInfo(e);const r=6e4*l.start.getTimezoneOffset()*-1;null===(n=this.uiHandlersBridge)||void 0===n||n.send("dragAppointment",{start:z.addTimeSpan(this.appointmentInfo.getStart(),r),end:z.addTimeSpan(this.appointmentInfo.getEnd(),r),isAllDay:this.appointmentInfo.allDay,resourceKey:this.appointmentInfo.resourceKey}),this.currentCellInfo=t}resize(t,e){var i;if(!this.appointmentInfo||!this.currentCellInfo)return;const n=t.interval,s=this.currentCellInfo.interval;if(s.start.valueOf()-n.start.valueOf()==0&&s.duration===n.duration||s.isLongerOrEqualDay!==n.isLongerOrEqualDay)return;const o=this.currentCellInfo.interval.start.valueOf()-n.start.valueOf();e&&this.dateDiff?this.appointmentInfo.interval=new x(z.addTimeSpan(n.start,this.dateDiff),this.appointmentInfo.interval.duration+o):this.appointmentInfo.interval.duration-=o,this.updateResource(this.currentCellInfo.cell);const l=6e4*n.start.getTimezoneOffset()*-1;null===(i=this.uiHandlersBridge)||void 0===i||i.send("dragAppointment",{start:z.addTimeSpan(this.appointmentInfo.getStart(),l),end:z.addTimeSpan(this.appointmentInfo.getEnd(),l),isAllDay:this.appointmentInfo.allDay,resourceKey:this.appointmentInfo.resourceKey}),this.currentCellInfo=t}dragEnd(){var t;this.removeAppointmentTopPositionInfo(),null===(t=this.uiHandlersBridge)||void 0===t||t.send("dropAppointment","")}findAppointmentViewByInterval(t,e){return t.find((t=>{if(e&&t.firstCell&&t.lastCell){const i=z.getCellInterval(t.firstCell).getStart(),n=z.getCellInterval(t.lastCell).getEnd();if(e.intersectsWith(new x(i,n.valueOf()-i.valueOf())))return t}}))}updateEditedAppointmentPosition(t){const e=this.scheduler.getEditableAppointments();if(!this.lastCell||0===e.length||!this.currentCellInfo)return;const i=this.findAppointmentViewByInterval(e,this.currentCellInfo.interval);if(!i)return;if(!S.isHorizontalAppointment(i))return void(this.horizontalAppointmentDragged=!1);let n=!1;if(this.horizontalAppointmentDragged||(this.initialTop-=i.offsetHeight/2,this.lastTop=this.initialTop,this.horizontalAppointmentDragged=!0,n=!0),t){const e=this.getViewportScrollTop(),i=t.pageY-this.initialPageY+(e-this.initialScrollTop);this.lastTop=this.initialTop+i,n=n||0!==i}if(n||this.lastCellChanged){const t=this.lastCell.offsetTop+1;this.lastTop=Math.min(this.lastTop,t+this.lastCell.offsetHeight-i.offsetHeight-2),this.lastTop=Math.max(t,this.lastTop)}const s=this.lastTop-this.lastCell.offsetTop;e.forEach((t=>{const e=t,i=e.firstCell,n=i.offsetTop+i.offsetHeight-e.offsetHeight-2;let o=i.offsetTop+s;o>=n&&(o=n),e.style.top=o+"px",e.style.zIndex="1000"}))}saveAppointmentTopPositionInfo(t){var e;if(!this.lastCell)return;const i=this.lastTop-this.lastCell.offsetTop;null===(e=this.scheduler.getView())||void 0===e||e.setAttribute("data-appointment-top-position",i.toString())}removeAppointmentTopPositionInfo(){var t;null===(t=this.scheduler.getView())||void 0===t||t.removeAttribute("data-appointment-top-position")}updateResource(t){this.appointmentInfo&&this.appointmentInfo.resourceKey&&(this.appointmentInfo.resourceKey=S.Attr.getResourceKey(t))}getViewportScrollTop(t){const e=t||this.lastCell;if(!e)return 0;const i=S.getParentTimeCellsViewport(e);return(null==i?void 0:i.scrollTop)||0}}class D{constructor(t,e){this.scheduler=t,this.uiHandlersBridge=e,this.interval=null,this.direction=null}start(t){var e;this.interval=z.getCellInterval(t);const i=this.interval.start,n=z.dateIncreaseWithUtcOffset(i,this.interval.duration),s=S.Attr.getResourceKey(t),o=6e4*i.getTimezoneOffset()*-1;null===(e=this.uiHandlersBridge)||void 0===e||e.send("startCellSelection",{start:z.addTimeSpan(i,o),end:z.addTimeSpan(n,o),isAllDay:D.isAllDayCell(t),resourceKey:s})}resizeTo(t){var e;if(!this.interval)return;const i=z.getCellInterval(t),n=i.start.valueOf()-this.interval.start.valueOf();if(0===n&&this.interval.duration===i.duration)return;n<0&&this.interval.duration===i.duration?this.direction="top":n>0&&this.interval.duration===i.duration&&(this.direction="bottom"),"bottom"===this.direction?this.interval.duration=n+i.duration:"top"===this.direction&&(this.interval.start=i.start,this.interval.duration+=-1*n);const s=this.interval.start,o=z.dateIncreaseWithUtcOffset(s,this.interval.duration),l=S.Attr.getResourceKey(t),r=6e4*s.getTimezoneOffset()*-1;null===(e=this.uiHandlersBridge)||void 0===e||e.send("resizeCellSelection",{start:z.addTimeSpan(s,r),end:z.addTimeSpan(o,r),isAllDay:D.isAllDayCell(t),resourceKey:l})}end(){var t;null===(t=this.uiHandlersBridge)||void 0===t||t.send("endCellSelection",this.scheduler.getEditToolTipShowingArgs())}static isAllDayCell(e){return t.hasClassName(e,"dxbs-sc-all-day-area")}}class M{constructor(t,e){this.scheduler=t,this.viewport=S.getTimeCellsViewport(this.scheduler),this.callback=e,this.timerId=-1,this.lastCoords={},this.shiftX=0,this.shiftY=0,this.scrollingInProgress=!1}scrollTo(t){if(!this.viewport)return;this.lastCoords=t,this.shiftX=0,this.shiftY=0;const e=this.viewport.getBoundingClientRect();if(t.clientX-e.left<=50?this.shiftX=-8:e.right-t.clientX<=50&&(this.shiftX=8),t.clientY-e.top<=50?this.shiftY=-8:e.bottom-t.clientY<=50&&(this.shiftY=8),this.shiftX||this.shiftY){if(-1===this.timerId){const t=this.scrollingInProgress?20:500;this.timerId=setTimeout(this.onTimeout.bind(this),t)}}else this.end()}onTimeout(){this.scrollingInProgress=!0,this.timerId=-1,this.viewport.scrollLeft+=this.shiftX,this.viewport.scrollTop+=this.shiftY,setTimeout((()=>this.callback.apply(this.scheduler,[this.lastCoords])))}end(){this.scrollingInProgress=!1,-1!==this.timerId&&(clearTimeout(this.timerId),this.timerId=-1)}}class B{constructor(){this.TIMEOUT=6e4,this.subscriptions=[],this.timerId=-1}subscribe(t,e){if(-1===this.getSubscriptionIndex(t)){this.subscriptions.push({scheduler:t,updateAction:e}),-1===this.timerId&&this.startTimer()}}unsubscribe(t){const e=this.getSubscriptionIndex(t);-1!==e&&this.unsubscribeByIndex(e),0===this.subscriptions.length&&this.stopTimer()}unsubscribeByIndex(t){this.subscriptions.splice(t,1)}getSubscriptionIndex(t){for(let e,i=0;e=this.subscriptions[i];i++)if(e.scheduler===t)return i;return-1}startTimer(){this.timerId=setTimeout(this.onTimeout.bind(this),this.TIMEOUT)}stopTimer(){-1!==this.timerId&&(clearTimeout(this.timerId),this.timerId=-1)}onTimeout(){for(let t,e=0;t=this.subscriptions[e];e++)if(B.isElementValid(t.scheduler))try{t.updateAction()}catch(t){}else this.unsubscribeByIndex(e),e--;this.startTimer()}static isElementValid(t){for(;null!=t;){if("BODY"===t.tagName)return!0;t=t.parentNode}return!1}}const P=new B;const R={x:null,y:null,showCallout:!0,showTitle:!1,position:"right",className:"",classNames:{sysClassName:"dx-hint",contentElementClassName:"dxh-content",calloutElementClassName:"popover-arrow arrow",titleElementClassName:"dxh-title"},allowFlip:!0,allowShift:!0,offset:4};const k=g.toUpperCase();function L(t,e,i,n){return{left:t,top:e,right:i,bottom:n,width:i-t,height:n-e}}const N="none",F="drag",j="resizeTop",K="resizeBottom",q="resizeSelection";class W extends n{constructor(){super(),this.cellSelectionHelper=null,this.autoScrollHelper=null,this.dragHelper=null,this.mouseMoveHandlerState=N,this.allowCreateAppointment=!1,this.allowEditAppointment=!1,this.enableAppointmentTooltip=!1,this.activeFormType=I.None,this.tooltipPositionInfo={position:"Right",rect:new DOMRect}}initializeComponent(){super.initializeComponent(),this.uiHandlersBridge=this.querySelector(s),this.initEvents(),this.adjustControl()}disposeComponent(){delete this.uiHandlersBridge,this.elementContentSizeSubscription&&d(this.elementContentSizeSubscription),super.disposeComponent()}getView(){return this.querySelector("dxbl-view")}adjustControl(){var t;null===(t=this.getView())||void 0===t||t.adjust(),this.showAppointmentToolTip()}initEvents(){y.attachEventToElement(this,"mousedown",this.mouseDownEventHandler.bind(this),null),y.attachEventToElement(this,"mouseup",this.mouseUpEventHandler.bind(this),null),y.attachEventToElement(this,"mousemove",this.mouseMoveEventHandler.bind(this),null),y.attachLongTabEventToElement(this,this.getTouchLongPressEventHandler.bind(this)),y.attachEventToElement(this,"touchstart",this.touchStartEventHandler.bind(this),null),y.attachEventToElement(this,"touchmove",this.touchMoveEventHandler.bind(this),null),y.attachEventToElement(this,"touchend",this.touchEndEventHandler.bind(this),null),this.elementContentSizeSubscription=m(this,this.adjustControl.bind(this))}selectAppointment(e){var i;e&&(t.addClassName(e,"dxbs-apt-selected"),null===(i=this.uiHandlersBridge)||void 0===i||i.send("selectAppointment",{key:S.Attr.getAppointmentKey(e)}))}getSelectedAppointmentInfo(){const t=S.getSelectedAppointment(this);return t?this.getAppointmentInfo(S.Attr.getAppointmentKey(t)):null}getAppointmentInfo(t){const e=this.getView();return e?e.appointmentInfos.filter((e=>e.id===t))[0]:null}getAppointmentToolTip(){return this.querySelector("dxbl-appointment-tooltip")}getEditableAppointments(){return S.getEditableAppointments(this)}getSelectedAppointment(){const t=S.getSelectedAppointment(this),e=this.lastMouseUpEventInfo?this.lastMouseUpEventInfo.appointment:null;return t&&e&&S.Attr.getAppointmentKey(e)===S.Attr.getAppointmentKey(t)?e:t}showAppointmentToolTip(){var t;if(this.activeFormType===I.AppointmentToolTip||this.activeFormType===I.AppointmentCompactEditForm){const e=S.getSelectedAppointment(this),i=this.lastMouseUpEventInfo?this.lastMouseUpEventInfo.appointment:null,n=e&&i&&S.Attr.getAppointmentKey(i)===S.Attr.getAppointmentKey(e)?i:e;n&&(null===(t=this.getAppointmentToolTip())||void 0===t||t.show(n))}}mouseDownEventHandler(t){if(C("TouchStart")||2===t.button)return void(2===t.button&&i.preventEventAndBubble(t));const e=t.srcElement,n=S.getAppointmentContainer(e);if(n)S.isAppointmentSelected(n)||this.selectAppointment(n),this.allowEditAppointment&&(S.isTopHandleElement(e)||S.isLeftHandleElement(e)?this.mouseMoveHandlerState=j:S.isBottomHandleElement(e)||S.isRightHandleElement(e)?this.mouseMoveHandlerState=K:T((()=>{this.mouseMoveHandlerState=F}),"drag",50,!0));else if(this.activeFormType===I.None){const t=S.getTimeCellContainer(e);this.allowCreateAppointment&&t&&(this.cellSelectionHelper=new D(this,this.uiHandlersBridge),this.cellSelectionHelper.start(t),this.mouseMoveHandlerState=q)}}mouseMoveEventHandler(t){this.mouseMoveHandlerState!==N&&(0!==t.buttons?(this.throttledDrag||(this.throttledDrag=class{static throttle(t,e){let i=!1,n=null,s=this;return function o(l){if(i)return n=l,void(s=this);t.apply(this,[l]),i=!0,setTimeout((()=>{i=!1,n&&(o.apply(s,[n]),n=null)}),e)}}}.throttle(this.mouseMoveEventHandlerInternal,20)),this.throttledDrag(t)):this.mouseUpEventHandler(t))}mouseMoveEventHandlerInternal(t){var e;const i=null===(e=this.getView())||void 0===e?void 0:e.findCellByCoordinates(t.clientX,t.clientY);if(i)if(this.autoScrollHelper||(this.autoScrollHelper=new M(this,this.mouseMoveEventHandlerInternal)),this.autoScrollHelper.scrollTo(t),this.mouseMoveHandlerState===q&&this.cellSelectionHelper)this.cellSelectionHelper.resizeTo(i.cell);else{const e=this.getSelectedAppointmentInfo();e&&(this.mouseMoveHandlerState!==F&&this.mouseMoveHandlerState!==j&&this.mouseMoveHandlerState!==K||(this.dragHelper||(this.dragHelper=new V(this,this.uiHandlersBridge),this.dragHelper.dragStart(e,i,t)),this.mouseMoveHandlerState===F?this.dragHelper.drag(i,t):this.dragHelper.resize(i,this.mouseMoveHandlerState===j)))}}mouseUpEventHandler(t){const e=t;if(C("TouchEnd")||e&&2===e.button)return void(2===e.button&&i.preventEventAndBubble(t));const n=S.getAppointmentContainer(t.srcElement);this.dragHelper||this.cellSelectionHelper?(this.dragHelper?(this.dragHelper.dragEnd(),this.dragHelper=null):this.cellSelectionHelper&&(this.cellSelectionHelper.end(),this.cellSelectionHelper=null),this.autoScrollHelper&&(this.autoScrollHelper.end(),this.autoScrollHelper=null)):this.enableAppointmentTooltip&&n&&!C("skipToolTip")&&(this.startAppointementToolTipShowing(n),T((()=>{}),"skipToolTip",300,!1)),b("drag"),this.lastMouseUpEventInfo=n?{appointment:n}:{},this.mouseMoveHandlerState=N}startAppointementToolTipShowing(t){var e;const i=this.getToolTipShowingArgs(t);null===(e=this.uiHandlersBridge)||void 0===e||e.send("showAppointmentToolTip",i)}startAppointmentEditToolTipShowing(){var t;const e=this.getEditToolTipShowingArgs();e&&(null===(t=this.uiHandlersBridge)||void 0===t||t.send("showAppointmentEditToolTip",e))}getToolTipShowingArgs(t){const e=t.getBoundingClientRect(),i=this.getTooltipPosition(e);return this.getToolTipShowingArgsCore(i,e)}getTooltipPosition(t){const e=this.getBoundingClientRect();return e.right-t.right>370?"Right":t.left-e.left>370?"Left":t.top-e.top>370?"Top":"Bottom"}getEditToolTipShowingArgs(){const t=this.getSelectedAppointment();if(!t)return;const e=t.getBoundingClientRect(),i=this.getEditTooltipPosition(e);return this.getToolTipShowingArgsCore(i,e)}getEditTooltipPosition(t){const e=this.getBoundingClientRect();return e.right-t.right>450?"Right":t.left-e.left>450?"Left":"Center"}getToolTipShowingArgsCore(t,e){return this.tooltipPositionInfo={position:t,rect:e},{position:t,aptLeft:Math.round(e.left),aptTop:Math.round(e.top),aptWidth:Math.round(e.width),aptHeight:Math.round(e.height)}}touchStartEventHandler(t){T((()=>{}),"TouchStart",300,!0);const e=S.getAppointmentContainer(t.srcElement);this.selectAppointment(e)}getTouchLongPressEventHandler(t){var e;const i=t.srcElement,n=S.getAppointmentContainer(i);if(n){const i=t.touches[0],s=i.clientX,o=i.clientY,l=null===(e=this.getView())||void 0===e?void 0:e.findCellByCoordinates(s,o),r=this.getAppointmentInfo(S.Attr.getAppointmentKey(n));if(l&&r){const t=new V(this,this.uiHandlersBridge);this.dragHelper=t,t.dragStart(r,l,i)}}else{const t=S.getTimeCellContainer(i);if(t&&!this.getAppointmentToolTip()){const e=new D(this,this.uiHandlersBridge);this.cellSelectionHelper=e,e.start(t)}}}touchMoveEventHandler(t){var e;if(!this.dragHelper&&!this.cellSelectionHelper)return;const n=t.touches[0],s=n.clientX,o=n.clientY,l=null===(e=this.getView())||void 0===e?void 0:e.findCellByCoordinates(s,o);l&&(this.dragHelper?this.dragHelper.drag(l,n):this.cellSelectionHelper&&this.cellSelectionHelper.resizeTo(l.cell)),i.preventEventAndBubble(t)}touchEndEventHandler(t){this.mouseUpEventHandler(t),T((function(){}),"TouchEnd",300,!0)}static get observedAttributes(){return["allow-create-appointment","allow-edit-appointment","enable-appointment-tooltip","active-form-type"]}attributeChangedCallback(t,e,i){switch(t){case"allow-create-appointment":this.allowCreateAppointment=null!==i;break;case"allow-edit-appointment":this.allowEditAppointment=null!==i;break;case"enable-appointment-tooltip":this.enableAppointmentTooltip=null!==i;break;case"active-form-type":this.activeFormType=parseInt(i),setTimeout((()=>{this.showAppointmentToolTip()}),0)}}}customElements.define("dxbl-scheduler",W),customElements.define("dxbl-appointment-tooltip",class extends n{constructor(){super(),this.appointmentPositionChangedHandler=this.handleAppointmentPositionChanged.bind(this),this.appointmentPositionObserver=new v(this.appointmentPositionChangedHandler,{raf:!1}),this.arrorClassNameRegExp=/bs-popover-(left|right|top|bottom|center)/,this.scheduler=null,this.editButton=null,this.editButtonClickHandler=this.onEditButtonClick.bind(this)}initializeComponent(){if(super.initializeComponent(),this.scheduler=o(this,"dxbs-scheduler"),this.scheduler){this.uiHandlersBridge=this.scheduler.querySelector(s),this.initEvents(),setTimeout((()=>{this.initEditButton()}),400);const t=this.findTargetAppointment();t&&this.appointmentPositionObserver.observe(t)}}disposeComponent(){var t;super.disposeComponent(),document.removeEventListener(f.touchMouseDownEventName,this.toolTipLostFocusHandler),null===(t=this.editButton)||void 0===t||t.removeEventListener("click",this.editButtonClickHandler),this.editButton=null,this.appointmentPositionObserver.disconnect()}initEvents(){this.toolTipLostFocusHandler=t=>{const e=S.getAppointmentContainer(t.srcElement);return(!e||!S.isAppointmentSelected(e))&&function(t,e,i){return function(t,e,i){let n=t.target;for(;n;){if(n===e||n.tagName===k)return!1;n=n.parentElement}i&&i();return!0}(t,e,(function(){e&&"string"!=typeof e&&"none"!==e.style.display&&(null==i||i.send("hideAppointmentToolTip",""))}))}(t,this,this.uiHandlersBridge)},document.addEventListener(f.touchMouseDownEventName,this.toolTipLostFocusHandler)}initEditButton(){var t;this.editButton=this.findElement(".dxsc-edit-button"),null===(t=this.editButton)||void 0===t||t.addEventListener("click",this.editButtonClickHandler)}findElement(t){if(!this.scheduler)return null;return document.querySelector(`.dxbs-scheduler-instance-${this.scheduler.id} ${t}`)}findTargetAppointment(){return this.scheduler?this.scheduler.querySelector(`#${this.scheduler.id} .dxbs-apt-selected`):null}onEditButtonClick(){var t;null===(t=this.scheduler)||void 0===t||t.startAppointmentEditToolTipShowing()}handleAppointmentPositionChanged(t,e){const i=this.findTargetAppointment();if(!i||!this.scheduler)return;const n=i.getBoundingClientRect(),s=this.scheduler.tooltipPositionInfo;(!("Left"!==s.position&&"Right"!==s.position||s.rect.x===n.x&&s.rect.width===n.width)||!("Top"!==s.position&&"Bottom"!==s.position||s.rect.y===n.y&&s.rect.height===n.height))&&this.reposition(n)}reposition(e){const i=this.findElement("");if(!this.scheduler||!i)return;const n=o(i,"dxbs-dropdown");if(!n||"center"!==n.getAttribute("placement"))return;const s=t.hasClassName(i,"dxsc-edit-tooltip")?this.scheduler.getEditTooltipPosition(e):this.scheduler.getTooltipPosition(e);this.scheduler.tooltipPositionInfo={position:s,rect:e};const l=L(Math.round(e.left),Math.round(e.top),Math.round(e.right),Math.round(e.bottom)),r=this.caluclatePositionModel(s,l);this.applyPositionModel(n,r),this.updateArrowClassName(i,s)}updateArrowClassName(e,i){const n=`bs-popover-${i.toLowerCase()}`,s=this.arrorClassNameRegExp.exec(e.className);if(s){if(s[0]===n)return;t.removeClassName(e,s[0])}t.addClassName(e,n)}caluclatePositionModel(t,e){const i=21,n=1e5,s={restrictionMode:"rectangle",restrictionRectangle:null,horizontalOffset:0,verticalOffset:0};switch(t){case"Left":s.restrictionRectangle=L(-1e5,-1e5,e.left-i+2,n),s.horizontalOffset=-21;break;case"Right":s.restrictionRectangle=L(e.right+i-2,-1e5,n,n),s.horizontalOffset=i;break;case"Top":s.restrictionRectangle=L(-1e5,-1e5,n,e.top-i+2),s.verticalOffset=-21;break;case"Bottom":s.restrictionRectangle=L(-1e5,e.bottom+i-2,n,n),s.verticalOffset=i;break;case"Center":s.restrictionMode="viewport"}return s}applyPositionModel(t,e){t.setAttribute("restrict",e.restrictionMode),t.setAttribute("horizontal-offset",e.horizontalOffset.toString()),t.setAttribute("vertical-offset",e.verticalOffset.toString()),e.restrictionRectangle?t.setAttribute("restrict-rect",`${e.restrictionRectangle.left}, ${e.restrictionRectangle.top}, ${e.restrictionRectangle.width}, ${e.restrictionRectangle.height}`):t.removeAttribute("restrict-rect")}show(t){}getOptions(e,i){const n=e.getBoundingClientRect(),s=i.getBoundingClientRect();return R.position=t.hasClassName(this,"dxsc-tooltip")?n.right-s.right>370?"right":s.left-n.left>370?"left":s.top-n.top>370?"top":"bottom":n.right-s.right>450?"right":s.left-n.left>450?"left":"auto",R}}),customElements.define("dxbl-view",class extends n{constructor(){super(),this.scheduler=null,this.hApts=[],this.vApts=[],this.appointmentInfos=[],this.editableAppointmentKey="",this.doubleClickHandler=this.onDoubleClick.bind(this)}initializeComponent(){super.initializeComponent(),this.scheduler=o(this,"dxbs-scheduler"),this.initEvents(),this.recalculateLayout()}disposeComponent(){super.disposeComponent(),this.scheduler=null,P.unsubscribe(this),document.removeEventListener("dblclick",this.doubleClickHandler)}recalculateLayout(){this.initTimeCells(),this.initAppointments(!1),this.adjust()}recalculateAppointments(t,e){this.initAppointments(e),e?this.calculateEditableAppointments():this.calculateAppointments(t)}adjust(){this.calculateAppointments(!0),this.updateTimeMarkers()}findCellByCoordinates(t,e){var i,n;let s=H.Vertical,o=null===(i=this.vView)||void 0===i?void 0:i.findCellByPos(t,e);return o||(o=null===(n=this.hView)||void 0===n?void 0:n.findCellByPos(t,e),s=H.Horizontal),o?{cell:o,layoutType:s,allDay:S.Attr.getAllDay(o),interval:z.getCellInterval(o)}:null}initEvents(){P.subscribe(this,this.updateTimeMarkers.bind(this));const t=S.getTimeCellsViewport(this);t&&!t.scrollHandler&&(t.scrollHandler=this.viewportScrollEventHandler.bind(this),t.addEventListener("scroll",t.scrollHandler)),document.addEventListener("dblclick",this.doubleClickHandler)}onDoubleClick(t){var e;const i=S.getAppointmentContainer(t.srcElement);i&&this.contains(i)&&(null===(e=this.scheduler)||void 0===e||e.startAppointmentEditToolTipShowing())}initTimeCells(){var t,e;null===(t=this.getHorizontalViewPart())||void 0===t||t.clearObjects(),null===(e=this.getVerticalViewPart())||void 0===e||e.clearObjects()}initAppointments(t){var e,i;this.hApts=t?S.getHorizontalEditableAppointments(this):S.getHorizontalAppointments(this),this.vApts=t?S.getVerticalEditableAppointments(this):S.getVerticalAppointments(this),this.prepareAppointments(null===(e=this.hView)||void 0===e?void 0:e.getTimeCells(),this.hApts),this.prepareAppointments(null===(i=this.vView)||void 0===i?void 0:i.getTimeCells(),this.vApts),this.appointmentInfos=O.createItems(this.hApts),this.appointmentInfos=this.appointmentInfos.concat(O.createItems(this.vApts))}updateTimeMarkers(){var t,e;S.isTimelineView(this)?this.calculateHorizontalTimeMarker(this,null===(t=this.hView)||void 0===t?void 0:t.getFirstContainer()):this.calculateVerticalTimeMarkers(this,null===(e=this.vView)||void 0===e?void 0:e.getTimeCells())}calculateAppointments(t){var e;if(0===this.hApts.length&&0===this.vApts.length)return;const i=null===(e=this.hView)||void 0===e?void 0:e.getContainers();i&&(this.resetCalculationInfo(),t?this.calculateHorizontalAppointmentsAndCells(this,i):this.calculateHorizontalAppointments(i)),this.calculateVerticalAppointments(this.vApts),t&&this.calculateScrollingSpacers(this)}calculateEditableAppointments(){var t;if(null===(t=this.hView)||void 0===t?void 0:t.getContainers()){this.resetCalculationInfo();for(let t,e=0;t=this.hApts[e];e++){this.calculateHorizontalAppointmentCore(t);const e=this.getAttribute("data-appointment-top-position"),i=e?parseInt(e):0;t.style.top=t.firstCell.offsetTop+i+"px"}}this.calculateVerticalAppointments(this.vApts)}calculateVerticalAppointments(t){for(let e,i=0;e=t[i];i++)this.calculateVerticalAppointment(e)}calculateVerticalAppointment(t){const e=t.firstCell,i=(e.offsetWidth-10)/S.Attr.getAppointmentColumnsCount(t),n=S.Attr.getAppointmentRow(t)-S.Attr.getAppointmentFirstCellIndex(t),s=e.offsetTop+e.offsetHeight*n,o=S.Attr.getAppointmentColumn(t),l=e.offsetLeft+i*o,r=Math.floor(e.getBoundingClientRect().height*S.Attr.getAppointmentRowSpan(t));this.updateAppointmentCompactStyle(t,i),t.style.top=`${s}px`,t.style.left=`${l}px`,t.style.width=`${i}px`,t.style.height=`${r}px`,t.style.display=""}calculateScrollingSpacers(t){const e=S.getTimeCellsViewport(t);if(!e)return;let i=0;e.scrollWidth!==e.offsetWidth&&(i=e.offsetHeight-e.clientHeight);let n=0;e.scrollHeight!==e.offsetHeight&&(n=e.offsetWidth-e.clientWidth);const s=S.getHorizontalScrollSpacer(t);s&&i&&(s.style.height=i+"px");const o=S.getVerticalScrollSpacer(t);o&&n&&(o.style.width=n+"px"),s&&(s.style.display=i?"block":""),o&&(o.style.display=n?"block":"")}prepareAppointments(t,e){if(!t)return;const i={};for(let e,n=0;e=t[n];n++){e.intersects=[];const t=S.Attr.getContainerIndex(e);i[t]||(i[t]=[]),i[t].push(e)}for(let t,n=0;t=e[n];n++){const e=S.Attr.getContainerIndex(t),n=S.Attr.getAppointmentFirstCellIndex(t),s=S.Attr.getAppointmentLastCellIndex(t);if(i[e]){t.firstCell=i[e][n],t.lastCell=i[e][s],t.info={cellCount:s-n+1};for(let o=n;o<=s;o++){this.addIntersect(i[e][o],t)}}}}calculateHorizontalAppointments(t){for(const e in t){if(!Object.prototype.hasOwnProperty.call(t,e))continue;const i=t[e].cells;for(let t,e=0;t=i[e];e++)this.calculateHorizontalAppointmentsInCell(t)}}calculateHorizontalAppointmentsAndCells(t,i){e.Firefox&&this.lockHorizontalViewHeight(t);const n=this.prepareResourceHeaders(t,i);for(const t in i){if(!Object.prototype.hasOwnProperty.call(i,t))continue;let e=0;const s=i[t].cells;for(let t,i=0;t=s[i];i++){this.calculateHorizontalAppointmentsInCell(t);const i=this.getHorizontalCellHeight(t);i>e&&(e=i)}const o=s[0];let l=e?e+15:0;o.style.height="",l=Math.max(o.offsetHeight,l);const r=n[this.getElementResourceKey(o)];r&&(r.lastContainerIndex===t&&(l=Math.max(r.minHeight-r.height,l)),r.height+=l),o.style.height=l+"px"}for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&(n[t].element.style.height=n[t].height+"px");e.Firefox&&this.unlockHorizontalViewHeight(t)}calculateHorizontalAppointmentsInCell(t){const e=this.getCalculatedHorizontalAppointmentsInCell(t),i=this.getNotCalculatedHorizontalAppointmentsInCell(t);let n=t.offsetTop;if(t.lastElementChild&&S.isDateCellHeader(t.lastElementChild)){const e=window.getComputedStyle(t).paddingTop;n+=t.lastElementChild.offsetHeight+parseInt(e)}let s=null;do{s&&(n=s.info.calculatedTop+s.offsetHeight,s=null);let t=-1;for(;e.length&&-1===t;){const i=e[0];i.info.calculatedTop>n?(s=i,t=i.info.calculatedTop-n):n=i.info.calculatedTop+i.offsetHeight,e.shift()}let o=0;for(;o<i.length;){const e=i[o];e.info.precalculated||(this.calculateHorizontalAppointmentCore(e),e.info.precalculated=!0);const s=e.offsetHeight;-1===t||s<=t?(e.info.calculatedTop=n,e.style.top=n+"px",n+=s,-1!==t&&(t-=s),i.splice(o,1)):o++}}while(i.length)}getCalculatedHorizontalAppointmentsInCell(t){return t.intersects.filter((t=>void 0!==t.info.calculatedTop)).sort(((t,e)=>t.info.calculatedTop-e.info.calculatedTop))}getNotCalculatedHorizontalAppointmentsInCell(t){return t.intersects.filter((t=>void 0===t.info.calculatedTop)).sort(((t,e)=>{const i=e.info.cellCount-t.info.cellCount;return i||S.Attr.getStart(t).valueOf()-S.Attr.getStart(e).valueOf()}))}calculateHorizontalAppointmentCore(t){const e=t.firstCell,i=e.getBoundingClientRect().width,n=S.Attr.getAppointmentRow(t)-S.Attr.getAppointmentFirstCellIndex(t),s=e.offsetLeft+Math.floor(i*n),o=Math.floor(i*S.Attr.getAppointmentRowSpan(t));this.updateAppointmentCompactStyle(t,o),t.style.height="",t.style.width=`${o}px`,t.style.left=`${s}px`,t.style.top="-10000px",t.style.display=""}getHorizontalCellHeight(t){let e=-1,i=null;return t.intersects.forEach((t=>{t.info.calculatedTop>e&&(e=t.info.calculatedTop,i=t)})),i?e-t.offsetTop+i.offsetHeight:0}prepareResourceHeaders(t,e){const i={};for(const n in e){if(!Object.prototype.hasOwnProperty.call(e,n))continue;const s=this.getElementResourceKey(e[n].cells[0]),o=this.findTimelineResourceHeader(t,s);o&&(o.style.height="",null==i[s]?i[s]={element:o,height:0,minHeight:0,lastContainerIndex:n}:i[s].lastContainerIndex=n)}for(const t in i)Object.prototype.hasOwnProperty.call(i,t)&&(i[t].minHeight=i[t].element.offsetHeight);return i}resetCalculationInfo(){for(let t,e=0;t=this.hApts[e];e++)t.info={cellCount:t.info.cellCount}}updateAppointmentCompactStyle(e,i){t.toggleClassName(e.children[0],"dxbs-sc-apt-compact",i<50)}addIntersect(t,e){const i=t.intersects;i.findIndex((t=>S.Attr.getAppointmentKey(t)===S.Attr.getAppointmentKey(e)))<0&&i.push(e)}lockHorizontalViewHeight(t){const e=S.getHorizontalView(t);t.oldHViewMinHeight=e.style.minHeight;let i=e.getBoundingClientRect().height;i=Math.round(100*i)/100,e.style.minHeight=i+"px"}unlockHorizontalViewHeight(t){S.getHorizontalView(t).style.minHeight=t.oldHViewMinHeight}getOffsetWidth(t){return Math.floor(t.getBoundingClientRect().width)}calculateVerticalTimeMarkers(t,e){if(!e)return;const i=this.getCurrentLocalTime(),n=this.truncToDate(i),s=this.getTimeMarkerInfos(t);if(0!==s.length)for(let o,l=0;o=s[l];l++)this.calculateVerticalTimeMarker(o,t,e,n,i)}calculateVerticalTimeMarker(t,e,i,n,s){const o=t.wrapper,l=this.findCellsByTime(i,s,t.firstContainerIndex,t.lastContainerIndex);if(!l.length)return void(o.style.display="none");o.style.display="";const r=t.timeMarker,a=t.timeIndicator,c=r.offsetHeight/2,p=l[0].offsetLeft;let h=0;if(t.startFromContainer){const e=this.findFirstCellInContainer(i,t.firstContainerIndex);e&&(h=e.offsetLeft===p?p-c:e.offsetLeft)}const u=Math.floor(this.calculateTop(s,l[0],n));if(r.style.top=u-c+"px",r.style.left=h+"px",r.style.width=p-h+c+1+"px",this.isElementDisplayed(o)){let t=0;for(let e,i=0;e=l[i];i++)t+=e.offsetWidth;a.style.top=u-1+"px",a.style.width=t+"px",a.style.left=p+"px"}}getAdaptedContainerTime(t,e){const i=t,n=this.dateSubsWithTimezone(e,i);let s=Math.abs(n)%864e5;return n<0&&(s=864e5-s),this.dateIncreaseWithUtcOffset(i,s)}calculateTop(t,e,i){const n=this.getAdaptedContainerTime(i,t),s=S.Attr.getStart(e),o=S.Attr.getEnd(e),l=this.dateSubsWithTimezone(n,s);return e.offsetTop+e.offsetHeight*l/(o.valueOf()-s.valueOf())}calculateHorizontalTimeMarker(t,e){const i=S.getTimeMarkerImages(t),n=S.getTimeMarkerLine(t);if(!i.length||!n||!e)return;const s=this.getCurrentLocalTime(),o=e.cells[e.cells.length-1],l=S.Attr.getStart(e.cells[0]),r=S.Attr.getEnd(o).valueOf()-l.valueOf(),a=this.dateSubsWithTimezone(s,l)/r;if(a>0&&a<1){i.forEach((t=>{t.style.display="unset"})),n.style.display="unset";const t=Math.round(1e4*a)/100,e=n.offsetWidth/2,s=`calc(${t}% - ${i[0].offsetWidth/2}px)`;i.forEach((t=>{t.style.left=s})),n.style.left=`calc(${t}% - ${e}px)`}else i.forEach((t=>{t.style.display="none"})),n.style.display="none"}dateIncrease(t,e){return new Date(t.valueOf()+e)}dateIncreaseWithUtcOffset(t,e){const i=this.dateIncrease(t,e),n=6e4*(i.getTimezoneOffset()-t.getTimezoneOffset());return this.dateIncrease(i,n)}dateSubsWithTimezone(t,e){return t.valueOf()-e.valueOf()+6e4*(e.getTimezoneOffset()-t.getTimezoneOffset())}truncToDate(t){return new Date(t.getFullYear(),t.getMonth(),t.getDate())}isElementDisplayed(t){return t&&"none"!==t.style.display}findFirstCellInContainer(t,e){for(let i,n=0;i=t[n];n++)if(S.Attr.getContainerIndex(i)===e)return i;return null}findTimelineResourceHeader(t,e){if(""===e)return null;const i=S.getVerticalResourceHeaders(t);for(let t,n=0;t=i[n];n++)if(this.getElementResourceKey(t)===e)return t;return null}getTimeMarkerInfos(t){const e=[],i=S.getTimeMarkerWrappers(t);for(let t,n=0;t=i[n];n++){const i={wrapper:t,timeMarker:S.getTimeMarkerContainer(t),timeIndicator:S.getTimeIndicatorContainer(t),firstContainerIndex:S.Attr.getFirstContainerIndex(t),lastContainerIndex:S.Attr.getLastContainerIndex(t),startFromContainer:n>0};e.push(i)}return e}getCurrentLocalTime(){const t=(new Date).getTime();return new Date(t)}findCellsByTime(t,e,i,n){const s=[];for(let o,l=0;o=t[l];l++)S.Attr.getContainerIndex(o)<i||S.Attr.getContainerIndex(o)>n||e.valueOf()-S.Attr.getStart(o).valueOf()>=0&&S.Attr.getEnd(o).valueOf()-e.valueOf()>0&&s.push(o);return s}getHorizontalViewPart(){return this.hView||(this.hView=new E(this,".dxbs-sc-all-day-area, .dxbs-sc-horizontal-view .dxbs-sc-time-cell")),this.hView}getVerticalViewPart(){return this.vView||(this.vView=new E(this,".dxbs-sc-vertical-view .dxbs-sc-time-cell")),this.vView}getElementResourceKey(t){return S.Attr.getResourceKey(t)}viewportScrollEventHandler(t){const e=S.getTimeCellsViewport(this),i=S.getResourcesViewport(this);i&&(i.scrollTop=e.scrollTop);const n=S.getTimescaleViewport(this);n&&(n.scrollLeft=e.scrollLeft)}static get observedAttributes(){return["state","editable-appointment-key"]}attributeChangedCallback(t,e,i){if(this.isInitialized)switch(t){case"state":setTimeout((()=>{this.editableAppointmentKey?this.recalculateAppointments(!this.editableAppointmentKey,!0):this.recalculateLayout()}),0);break;case"editable-appointment-key":this.editableAppointmentKey=i}}});const Y={loadModule:function(){}};export{W as DxScheduler,Y as default};

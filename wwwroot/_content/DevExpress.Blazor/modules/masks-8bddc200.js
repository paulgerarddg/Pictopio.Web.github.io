import{B as e}from"./dom-b082d2b1.js";import{k as t}from"./key-5a3173a6.js";import{d as n,r as s}from"./disposable-d2c2d283.js";import{u as i,J as o,e as a,k as r}from"./dom-utils-8b753f73.js";class l{constructor(e,t){this.preloader=e,this.parent=t,this._initialPaddingRight=0,this._initialPaddingLeft=0,this._contentWidth=0,this._internalWidthChanging=!1,this._unsubscriber=()=>!1,this._onHide=new Array,this.preloaderElement=e,this._preloaderWidth=e.offsetWidth,this.parentElement=t}static get(e){return l.preloaderMap.get(e)}static create(e,t){let n=l.get(e);return n||(n=new l(e,t),l.preloaderMap.set(e,n)),n}static remove(e){const t=l.preloaderMap.get(e);t&&(t.hide(),l.preloaderMap.delete(e))}display(e){this.init(e),this.preloaderElement.style.top=(this.parentElement.offsetHeight-this.preloaderElement.offsetHeight)/2+"px",this.calculateHorizontalPosition(this.parentElement.clientWidth-this._initialPaddingLeft-this._initialPaddingRight),this._internalWidthChanging=!0,this._unsubscriber=this.subscribeOnParentWidthChange(),this.preloaderElement.classList.remove("dxbs-preloader-initial")}hide(){this.preloaderElement.onanimationend=()=>{this.preloaderElement.style.display="none",i(this._unsubscriber),this.parentElement.style.paddingRight=this._initialPaddingRight+"px",this._onHide.forEach((e=>{e()})),this._onHide=[]},this.preloaderElement.classList.add("dxbs-preloader-success")}registerOnHideAction(e){this._onHide.push(e)}changeInitialPaddingRight(e){this._initialPaddingRight=e}init(e){this._contentWidth=e;const t=getComputedStyle(this.parentElement);this._initialPaddingRight=parseFloat(t.paddingRight),this._initialPaddingLeft=parseFloat(t.paddingLeft)}subscribeOnParentWidthChange(){return o(this.parentElement,(e=>{this._internalWidthChanging?this._internalWidthChanging=!1:this.calculateHorizontalPosition(e)}))}calculateHorizontalPosition(e){const t=parseFloat(this.parentElement.style.paddingRight);if(0===e||t===this._initialPaddingRight&&e-this._preloaderWidth<0)return this.preloaderElement.style.visibility="hidden",void(t!==this._initialPaddingRight&&(this._internalWidthChanging=!0,this.parentElement.style.paddingRight=this._initialPaddingRight+"px"));if(this.preloaderElement.style.visibility="visible",e<this._preloaderWidth+this._contentWidth)this.preloaderElement.style.left="auto",this.preloaderElement.style.right=this._initialPaddingRight+"px",t!==this._initialPaddingRight+this._preloaderWidth&&(this.parentElement.style.paddingRight=this._initialPaddingRight+this._preloaderWidth+"px",this._internalWidthChanging=!0);else{this.preloaderElement.style.left="calc("+(this._contentWidth+this._initialPaddingLeft)+"px + "+(0===this._contentWidth?"0":"0.5")+"em)",t!==this._initialPaddingRight&&(this._internalWidthChanging=!0,this.parentElement.style.paddingRight=this._initialPaddingRight+"px")}}}var d;let h;l.preloaderMap=new Map,function(e){e[e.None=0]="None",e[e.Change=1]="Change",e[e.Input=2]="Input"}(d||(d={}));class u{constructor(){this.init_new_manager=window.Module.mono_bind_static_method("[DevExpress.Blazor.WebAssembly.Masks] MaskWrapper.MasksCollection:GetNewManager"),this.keyPress=window.Module.mono_bind_static_method("[DevExpress.Blazor.WebAssembly.Masks] MaskWrapper.MasksCollection:KeyPress"),this.clear=window.Module.mono_bind_static_method("[DevExpress.Blazor.WebAssembly.Masks] MaskWrapper.MasksCollection:Clear"),this.paste=window.Module.mono_bind_static_method("[DevExpress.Blazor.WebAssembly.Masks] MaskWrapper.MasksCollection:Paste"),this.getValue=window.Module.mono_bind_static_method("[DevExpress.Blazor.WebAssembly.Masks] MaskWrapper.MasksCollection:GetValue"),this.setValue=window.Module.mono_bind_static_method("[DevExpress.Blazor.WebAssembly.Masks] MaskWrapper.MasksCollection:SetValue"),this.setSelection=window.Module.mono_bind_static_method("[DevExpress.Blazor.WebAssembly.Masks] MaskWrapper.MasksCollection:SetSelection"),this.disposeMaskManager=window.Module.mono_bind_static_method("[DevExpress.Blazor.WebAssembly.Masks] MaskWrapper.MasksCollection:DisposeMaskManager"),this.updateProperties=window.Module.mono_bind_static_method("[DevExpress.Blazor.WebAssembly.Masks] MaskWrapper.MasksCollection:UpdateProperties")}}class p{constructor(e){e.includes("\\")&&(e=e.split("\\").join("\\\\")),this.info=JSON.parse(e)}get selectionStart(){return this.info.selectionStart}get selectionEnd(){return this.info.selectionEnd}get value(){return this.info.value}get displayText(){return this.info.displayText}}class c{constructor(e,t){this.onDisposeActions=new Array,this.customWheelProcessing=!1,this.suppressFocusEvents=!1,this.focusByMouse=!1,this.internalButtonsFocusEventsBlocked=!1,this.inputElement=e,this.dotnetHelper=t}initializeEvents(e){const t=t=>{e.onKeyDown(t)},n=t=>{e.onKeyUp(t)},i=t=>{e.onClick(t)},o=t=>{e.onCut(t)},a=t=>{e.onPaste(t)},l=t=>{e.onDrop(t)},d=t=>{e.shouldProcessOnFocus()&&e.onFocusByTab(e.inputElement.value?e.inputElement.value.length:0),e.focusByMouse=!1},h=t=>{e.focusByMouse=!1,e.onFocusOut(t)},u=t=>{e.onWheel(t,e)},p=t=>{e.checkValidInput()&&(e.focusByMouse=!0)};this.inputElement.addEventListener("keydown",t),this.inputElement.addEventListener("keyup",n),this.inputElement.addEventListener("click",i),this.inputElement.addEventListener("cut",o),this.inputElement.addEventListener("paste",a),this.inputElement.addEventListener("drop",l),this.inputElement.addEventListener("focus",d),this.inputElement.addEventListener("focusout",h),this.inputElement.addEventListener("wheel",u,{passive:!1}),this.inputElement.addEventListener("mousedown",p);const c=r(this.inputElement,".dxbs-input-group");c&&this.blockButtonsFocusEvents(c,this),s(this.inputElement,(()=>{e.inputElement.removeEventListener("keydown",t),e.inputElement.removeEventListener("keyup",n),e.inputElement.removeEventListener("click",i),e.inputElement.removeEventListener("cut",o),e.inputElement.removeEventListener("paste",a),e.inputElement.removeEventListener("drop",l),e.inputElement.removeEventListener("focus",d),e.inputElement.removeEventListener("focusout",h),e.inputElement.removeEventListener("wheel",u),e.inputElement.removeEventListener("mousedown",p),e.dispose()}))}blockButtonsFocusEvents(t,n){if(e.MobileUI||this.internalButtonsFocusEventsBlocked)return;const s=t.querySelectorAll(".dxbs-btn-group button");if(s&&s.length>0){const e=()=>{n.setSuppressFocusEvents(!0)},t=()=>{n.setSuppressFocusEvents(!1),n.focusByMouse=!0};s.forEach((n=>{n.addEventListener("mousedown",e),n.addEventListener("focusout",t),this.onDisposeActions.push((()=>{n.removeEventListener("mousedown",e),n.removeEventListener("focusout",t)}))})),this.internalButtonsFocusEventsBlocked=!0}}setSuppressFocusEvents(e){this.suppressFocusEvents=e}dispose(){for(;this.onDisposeActions.length>0;){const e=this.onDisposeActions.pop();e&&e()}}disposeMaskManagerCore(){}checkValidInsertion(e,n){return e.keyCode===t.KeyCode.Backspace||e.keyCode===t.KeyCode.Delete||e.keyCode===t.KeyCode.Home||e.keyCode===t.KeyCode.Enter||e.keyCode===t.KeyCode.End||(e.keyCode===t.KeyCode.Up||e.keyCode===t.KeyCode.Down)&&!n||e.keyCode===t.KeyCode.Left||e.keyCode===t.KeyCode.Right||e.ctrlKey&&(e.keyCode===t.KeyCode.Key_a||e.keyCode===t.KeyCode.Key_z)||!e.ctrlKey&&1===e.key.length}shouldProcessOnFocus(){return!this.suppressFocusEvents&&!e.MobileUI&&!this.focusByMouse&&this.checkValidInput()}checkValidInput(){return!this.inputElement.disabled&&!this.inputElement.readOnly}canHandleMouseWheel(){return this.checkValidInput()&&document.activeElement===this.inputElement&&!this.customWheelProcessing}}class m extends c{constructor(e,t,n,s,i){super(e,t),this.managerId=-1,this.isWheelScrolling={timer:0},this.maskProperties=n,this.onInputMode=s,this.customWheelProcessing=n.customWheelProcessing,this.userEventsForInput=i,this.inputTextForUserOnChangeEvent=e.value}initializeMonoMasks(e,t){return new Promise(((n,s)=>{this.maskProperties&&this.maskProperties.editMask&&0!==this.maskProperties.maskMode?(this.inputElement.value=e,this.displayPreloader(),void 0!==h?(this.initializeInternal(t),n()):(m.maskLoadingPromise||this.loadMasks(),m.maskLoadingPromise.then((()=>{this.initializeInternal(t),n()})))):s()}))}initializeInternal(e){n(this.inputElement),this.managerId=h.init_new_manager(this.maskProperties.maskMode,this.maskProperties.editMask,this.maskProperties.placeholder,this.maskProperties.lcid,this.maskProperties.flags,this.maskProperties.valueString,this.maskProperties.valueType,e),this.initializeEvents(this),this.fadeOutPreloader(),this.inputElement.setAttribute("data-dx-client-mask-initialized","true")}loadMasks(){m.maskLoadingPromise||(m.maskLoadingPromise=new Promise(((e,t)=>{const n=document.createElement("script");n.src="_content/DevExpress.Blazor.Server.WebAssembly/dotnet.js",n.onload=function(){!function t(){window.MONO.mono_wasm_runtime_is_ready?(document.head.removeChild(n),h=new u,e(!0)):window.setTimeout(t,100)}()},document.head.appendChild(n)})))}displayPreloader(){const e=r(this.inputElement,".dxbs-input-group");if(!e)return;const t=e.querySelector(".dxbs-preloader-container"),n=l.create(t,this.inputElement);if(n){this.blockEvents(this.inputElement,n);let t=0;if(this.inputElement.value){const n=document.createElement("span");n.style.visibility="hidden",n.style.width="auto",n.style.position="fixed",n.innerHTML=this.inputElement.value,n.style.fontSize=getComputedStyle(this.inputElement).fontSize,e.append(n),t=n.clientWidth,n.remove()}n.display(t)}}blockEvents(e,t){function n(e){e.preventDefault(),e.stopPropagation()}const s=r(e,".dxbs-input-group");let i=[];s&&(i=s.querySelectorAll("button"),i&&i.forEach((e=>{e.addEventListener("click",n),e.addEventListener("mousedown",n),e.addEventListener("mouseup",n)}))),e.addEventListener("keydown",n),e.addEventListener("click",n),e.addEventListener("cut",n),e.addEventListener("paste",n),t.registerOnHideAction((function(){e.removeEventListener("keydown",n),e.removeEventListener("click",n),e.removeEventListener("cut",n),e.removeEventListener("paste",n),i&&i.forEach((e=>{e.removeEventListener("click",n),e.removeEventListener("mousedown",n),e.removeEventListener("mouseup",n)}))}))}fadeOutPreloader(){const e=r(this.inputElement,".dxbs-input-group");if(!e)return;const t=e.querySelector(".dxbs-preloader-container");l.remove(t)}getDispatchEventNames(e,t){if(!this.userEventsForInput||!this.checkValidInput())return[];const n=this.userEventsForInput&t;if(0===n)return[];const s=[];return this.inputElement.value!==e.displayText&&n&d.Input&&s.push("input"),this.inputElement.value!==this.inputTextForUserOnChangeEvent&&n&d.Change&&(s.push("change"),this.inputTextForUserOnChangeEvent=this.inputElement.value),s}applyMaskInfo(e,t,n=""){this.checkValidInput()&&(this.inputElement.value=n||e.displayText,t&&this.dotnetHelper&&this.dotnetHelper.invokeMethodAsync("SetValue",e.value)),this.inputElement.setAttribute("dx-mask-value",e.value),document.activeElement===this.inputElement&&this.inputElement.setSelectionRange(e.selectionStart,e.selectionEnd)}onKeyDown(n){if(e.AndroidMobilePlatform&&n.preventDefault(),!this.checkValidInsertion(n,this.maskProperties.customArrowsUpDownProcessing)||!this.checkValidInput()||e.AndroidMobilePlatform)return;n.preventDefault();const s=new p(h.keyPress(this.managerId,n.key,n.shiftKey,n.ctrlKey));let i=d.Input;n.keyCode===t.KeyCode.Enter&&(i|=d.Change);const o=this.getDispatchEventNames(s,i);this.applyMaskInfo(s,this.onInputMode||n.keyCode===t.KeyCode.Enter),y(o,this.inputElement),n.keyCode!==t.KeyCode.Left&&n.keyCode!==t.KeyCode.Right&&n.keyCode!==t.KeyCode.Home&&n.keyCode!==t.KeyCode.End||(this.suppressFocusEvents=!0,this.inputElement.blur(),this.inputElement.focus(),this.suppressFocusEvents=!1)}onKeyUp(n){if(this.checkValidInput())if(e.AndroidMobilePlatform){let e=n.key;229===n.keyCode&&(e=this.inputElement.value.substring(this.inputElement.selectionStart-1,this.inputElement.selectionStart));const s=new p(h.keyPress(this.managerId,e,!1,!1));this.applyMaskInfo(s,this.onInputMode||n.keyCode===t.KeyCode.Enter)}else n.keyCode!==t.KeyCode.Up&&n.keyCode!==t.KeyCode.Down||this.dotnetHelper.invokeMethodAsync("SetValue",this.inputElement.getAttribute("dx-mask-value"))}onClick(e){if(!this.checkValidInput())return;const t=new p(h.setSelection(this.managerId,this.inputElement.selectionStart,this.inputElement.selectionEnd));this.inputElement.selectionStart===this.inputElement.selectionEnd&&this.applyMaskInfo(t,!1)}onCut(e){if(!this.checkValidInput())return;e.preventDefault(),document.execCommand("copy");const t=new p(h.clear(this.managerId,this.inputElement.selectionStart,this.inputElement.selectionEnd));this.applyMaskInfo(t,this.onInputMode)}onPaste(e){if(!this.checkValidInput())return;e.preventDefault();const t=e.clipboardData,n=null==t?void 0:t.getData("Text"),s=new p(h.paste(this.managerId,n));this.applyMaskInfo(s,this.onInputMode)}onDrop(e){e.preventDefault()}onFocusByTab(e){const t=new p(h.setSelection(this.managerId,0,e));this.applyMaskInfo(t,!1)}onFocusOut(e){if(!this.checkValidInput()||this.suppressFocusEvents)return;e.preventDefault();const t=new p(h.getValue(this.managerId));this.dotnetHelper.invokeMethodAsync("OnFocusLost",t.value);const n=this.getDispatchEventNames(t,d.Change);this.applyMaskInfo(t,!1),y(n,this.inputElement)}onWheel(e,t){if(!this.canHandleMouseWheel())return;e.preventDefault(),window.clearTimeout(this.isWheelScrolling.timer);const n=new p(h.keyPress(this.managerId,e.deltaY<0?"ArrowUp":"ArrowDown",!1,!1));this.applyMaskInfo(n,!1),this.isWheelScrolling.timer=setTimeout((function(){t.dotnetHelper.invokeMethodAsync("SetValue",t.inputElement.getAttribute("dx-mask-value"))}),500)}disposeMaskManagerCore(){const e=r(this.inputElement,".dxbs-input-group");if(e){const t=e.querySelector(".dxbs-preloader-container");l.remove(t)}void 0!==h&&h.disposeMaskManager(this.managerId)}setValue(e,t,n){const s=new p(h.setValue(this.managerId,e,t));this.applyMaskInfo(s,!1,n)}updateMask(e,t){this.maskProperties=e;const n=new p(h.updateProperties(this.managerId,e.maskMode,e.editMask,e.placeholder,e.lcid,e.flags,e.valueString,e.valueType));this.applyMaskInfo(n,!1,t)}}m.maskLoadingPromise=null;class E extends c{constructor(e,t,n,s){super(e,t),this.customArrowsProcessing=n,this.customWheelProcessing=s}initialize(e){this.inputElement.value=e,this.initializeEvents(this)}onKeyDown(n){this.checkValidInsertion(n,this.customArrowsProcessing)&&this.checkValidInput()&&!e.AndroidMobilePlatform&&(n.preventDefault(),this.dotnetHelper.invokeMethodAsync("KeyDown",n.key,n.keyCode,n.shiftKey,n.ctrlKey),n.keyCode!==t.KeyCode.Left&&n.keyCode!==t.KeyCode.Right&&n.keyCode!==t.KeyCode.Home&&n.keyCode!==t.KeyCode.End||(this.suppressFocusEvents=!0,this.inputElement.blur(),this.inputElement.focus(),this.suppressFocusEvents=!1))}onKeyUp(n){if(e.AndroidMobilePlatform){let e=n.key;229===n.keyCode&&(e=this.inputElement.value.substring(this.inputElement.selectionStart-1,this.inputElement.selectionStart)),this.dotnetHelper.invokeMethodAsync("KeyDown",e,n.keyCode,!1,!1)}else n.keyCode!==t.KeyCode.Up&&n.keyCode!==t.KeyCode.Down||this.customArrowsProcessing||(n.preventDefault(),this.dotnetHelper.invokeMethodAsync("KeyUp",n.keyCode))}onClick(e){this.checkValidInput()&&this.dotnetHelper.invokeMethodAsync("SetSelection",this.inputElement.selectionStart,this.inputElement.selectionEnd)}onCut(e){this.checkValidInput()&&(e.preventDefault(),document.execCommand("copy"),this.dotnetHelper.invokeMethodAsync("Clear",this.inputElement.selectionStart,this.inputElement.selectionEnd))}onPaste(e){if(!this.checkValidInput())return;e.preventDefault();const t=e.clipboardData,n=null==t?void 0:t.getData("Text");this.dotnetHelper.invokeMethodAsync("Paste",n)}onDrop(e){e.preventDefault()}onFocusByTab(e){this.dotnetHelper.invokeMethodAsync("SetSelection",0,e)}onFocusOut(e){this.checkValidInput()&&!this.suppressFocusEvents&&(e.preventDefault(),this.dotnetHelper.invokeMethodAsync("OnFocusLost",null))}onWheel(e,t){this.canHandleMouseWheel()&&(e.preventDefault(),this.dotnetHelper.invokeMethodAsync("OnMouseWheel",e.deltaY<0))}}const k=new Map;function v(e){const t=[];return e&&(e&d.Change&&t.push("change"),e&d.Input&&t.push("input")),t}function y(e,t){e.forEach((e=>{t.dispatchEvent(new Event(e,{bubbles:!0}))}))}function g(e,t,n,s,i,o,a){return new Promise(((r,l)=>{let d=k.get(e);d||(d=new m(e,n,t,s,a),d.initializeMonoMasks(i,o).then((()=>{k.set(e,d),r()})).catch((()=>l())))}))}function M(e,t,n,s,i){let o=k.get(e);o||(o=new E(e,t,s,i),o.initialize(n),k.set(e,o))}function f(e,t,n,s,i){const o=k.get(e);o&&o.setValue(t,n,s);y(v(i),e)}function C(e,t,n){const s=k.get(t);s&&s.updateMask(e,n)}function b(e,t,n,s,i){e.value=t;y(v(i),e),document.activeElement===e&&e.setSelectionRange(n,s)}function _(e,t){const n=k.get(e);n&&n.blockButtonsFocusEvents(t,n)}function P(e){if(e=a(e)){n(e);k.get(e)&&k.delete(e)}return Promise.resolve("ok")}const w=Object.freeze({__proto__:null,initMonoMasks:g,initServerMasks:M,setValueToMonoMaskManager:f,updateRemoteMask:C,applyMaskParameters:b,blockFocusEventsForButtons:_,dispose:P,default:{initMonoMasks:g,setValueToMonoMaskManager:f,initServerMasks:M,applyMaskParameters:b,updateRemoteMask:C,dispose:P}});export{l as P,_ as b,w as m};
